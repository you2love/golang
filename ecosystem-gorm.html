<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GORM ORM - Go å­¦ä¹ æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css?v=1.4">
    </head>
<body>
    <div class="container">
        <aside class="sidebar">
        <!-- å¯¼èˆªæ å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </aside>
                <div class="content">
            <a href="ecosystem.html" class="back-link">â† è¿”å›ç¤¾åŒºåº“</a>
            <h1>GORM ORM</h1>
            <p class="intro">GORM æ˜¯ Go è¯­è¨€æœ€æµè¡Œçš„ ORM åº“ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ã€‚</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸ—„ï¸</div>
                    <h4>å¤šæ•°æ®åº“</h4>
                    <p>MySQL, PostgreSQL, SQLite</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”„</div>
                    <h4>è‡ªåŠ¨è¿ç§»</h4>
                    <p>Auto Migrate</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”—</div>
                    <h4>å…³è”</h4>
                    <p>ä¸°å¯Œçš„å…³è”æ”¯æŒ</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸª</div>
                    <h4>é’©å­</h4>
                    <p>ç”Ÿå‘½å‘¨æœŸé’©å­</p>
                </div>
            </div>

            <h2 id="gorm">GORM ORM</h2>
            
            <h3>ç®€ä»‹</h3>
            <p>GORM æ˜¯ Go è¯­è¨€ä¸­æœ€æµè¡Œçš„ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰åº“ï¼Œæä¾›äº†å‹å¥½çš„ APIï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLã€SQLiteã€SQL Server ç­‰ï¼‰ï¼Œå¹¶åŒ…å«è‡ªåŠ¨è¿ç§»ã€å…³è”ã€é’©å­ç­‰åŠŸèƒ½ã€‚</p>
            
            <h3>å®‰è£…</h3>
            <pre><code><span class="keyword">go</span> get -u gorm.io/gorm
<span class="keyword">go</span> get -u gorm.io/driver/mysql</code></pre>
            
            <h3>å¿«é€Ÿå¼€å§‹</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"gorm.io/driver/mysql"</span>
    <span class="string">"gorm.io/gorm"</span>
)

<span class="keyword">type</span> User <span class="keyword">struct</span> {
    ID       <span class="keyword">uint</span>   <span class="string">`gorm:"primaryKey"`</span>
    Name     <span class="keyword">string</span> <span class="string">`gorm:"size:255;not null"`</span>
    Email    <span class="keyword">string</span> <span class="string">`gorm:"size:255;uniqueIndex;not null"`</span>
    Age      <span class="keyword">int</span>    <span class="string">`gorm:"default:0"`</span>
    CreatedAt time.Time
    UpdatedAt time.Time
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è¿æ¥æ•°æ®åº“</span>
    dsn := <span class="string">"user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"</span>
    db, err := gorm.<span class="function">Open</span>(mysql.<span class="function">Open</span>(dsn), &gorm.Config{})
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="function">panic</span>(<span class="string">"Failed to connect database"</span>)
    }
    
    <span class="comment">// è‡ªåŠ¨è¿ç§»</span>
    db.<span class="function">AutoMigrate</span>(&User{})
    
    <span class="comment">// åˆ›å»ºè®°å½•</span>
    user := User{Name: <span class="string">"Alice"</span>, Email: <span class="string">"alice@example.com"</span>, Age: <span class="number">25</span>}
    result := db.<span class="function">Create</span>(&user)
    fmt.<span class="function">Println</span>(<span class="string">"Created user ID:"</span>, user.ID)
    fmt.<span class="function">Println</span>(<span class="string">"Rows affected:"</span>, result.RowsAffected)
}</code></pre>
            
            <h3>åˆ›å»ºè®°å½•</h3>
            <pre><code><span class="comment">// åˆ›å»ºå•æ¡è®°å½•</span>
user := User{Name: <span class="string">"Bob"</span>, Email: <span class="string">"bob@example.com"</span>, Age: <span class="number">30</span>}
db.<span class="function">Create</span>(&user)

<span class="comment">// åˆ›å»ºå¤šæ¡è®°å½•</span>
users := []User{
    {Name: <span class="string">"Charlie"</span>, Email: <span class="string">"charlie@example.com"</span>, Age: <span class="number">28</span>},
    {Name: <span class="string">"David"</span>, Email: <span class="string">"david@example.com"</span>, Age: <span class="number">32</span>},
}
db.<span class="function">Create</span>(&users)

<span class="comment">// ä½¿ç”¨ Select æŒ‡å®šå­—æ®µ</span>
db.<span class="function">Select</span>(<span class="string">"Name"</span>, <span class="string">"Email"</span>).<span class="function">Create</span>(&user)

<span class="comment">// ä½¿ç”¨ Omit å¿½ç•¥å­—æ®µ</span>
db.<span class="function">Omit</span>(<span class="string">"Age"</span>).<span class="function">Create</span>(&user)</code></pre>
            
            <h3>æŸ¥è¯¢è®°å½•</h3>
            <pre><code><span class="comment">// æŸ¥è¯¢ç¬¬ä¸€æ¡è®°å½•</span>
<span class="keyword">var</span> user User
db.<span class="function">First</span>(&user)
<span class="comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span>

<span class="comment">// æ ¹æ®ä¸»é”®æŸ¥è¯¢</span>
db.<span class="function">First</span>(&user, <span class="number">1</span>)
<span class="comment">// SELECT * FROM users WHERE id = 1;</span>

<span class="comment">// æŸ¥è¯¢æ‰€æœ‰è®°å½•</span>
<span class="keyword">var</span> users []User
db.<span class="function">Find</span>(&users)
<span class="comment">// SELECT * FROM users;</span>

<span class="comment">// æ¡ä»¶æŸ¥è¯¢</span>
db.<span class="function">Where</span>(<span class="string">"name = ?"</span>, <span class="string">"Alice"</span>).<span class="function">First</span>(&user)
db.<span class="function">Where</span>(<span class="string">"age > ?"</span>, <span class="number">25</span>).<span class="function">Find</span>(&users)
db.<span class="function">Where</span>(<span class="string">"name LIKE ?"</span>, <span class="string">"%A%"</span>).<span class="function">Find</span>(&users)

<span class="comment">// å¤šæ¡ä»¶</span>
db.<span class="function">Where</span>(<span class="string">"name = ? AND age > ?"</span>, <span class="string">"Alice"</span>, <span class="number">20</span>).<span class="function">First</span>(&user)

<span class="comment">// ä½¿ç”¨ Map</span>
db.<span class="function">Where</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"age"</span>: <span class="number">25</span>}).<span class="function">First</span>(&user)

<span class="comment">// ä½¿ç”¨ Struct</span>
db.<span class="function">Where</span>(User{Name: <span class="string">"Alice"</span>, Age: <span class="number">25</span>}).<span class="function">First</span>(&user)

<span class="comment">// Or æ¡ä»¶</span>
db.<span class="function">Where</span>(<span class="string">"name = ?"</span>, <span class="string">"Alice"</span>).<span class="function">Or</span>(<span class="string">"name = ?"</span>, <span class="string">"Bob"</span>).<span class="function">Find</span>(&users)

<span class="comment">// Not æ¡ä»¶</span>
db.<span class="function">Not</span>(<span class="string">"name = ?"</span>, <span class="string">"Alice"</span>).<span class="function">Find</span>(&users)

<span class="comment">// æ’åº</span>
db.<span class="function">Order</span>(<span class="string">"age desc"</span>).<span class="function">Find</span>(&users)

<span class="comment">// é™åˆ¶å’Œåç§»</span>
db.<span class="function">Limit</span>(<span class="number">10</span>).<span class="function">Offset</span>(<span class="number">20</span>).<span class="function">Find</span>(&users)

<span class="comment">// ç»Ÿè®¡</span>
<span class="keyword">var</span> count <span class="keyword">int64</span>
db.<span class="function">Model</span>(&User{}).<span class="function">Count</span>(&count)

<span class="comment">// é€‰æ‹©ç‰¹å®šå­—æ®µ</span>
db.<span class="function">Select</span>(<span class="string">"name"</span>, <span class="string">"email"</span>).<span class="function">Find</span>(&users)</code></pre>
            
            <h3>æ›´æ–°è®°å½•</h3>
            <pre><code><span class="comment">// æ›´æ–°å•ä¸ªå­—æ®µ</span>
db.<span class="function">Model</span>(&user).<span class="function">Update</span>(<span class="string">"age"</span>, <span class="number">26</span>)

<span class="comment">// æ›´æ–°å¤šä¸ªå­—æ®µ</span>
db.<span class="function">Model</span>(&user).<span class="function">Updates</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{
    <span class="string">"name"</span>: <span class="string">"Alice Updated"</span>,
    <span class="string">"age"</span>:  <span class="number">26</span>,
})

<span class="comment">// ä½¿ç”¨ Struct æ›´æ–°</span>
db.<span class="function">Model</span>(&user).<span class="function">Updates</span>(User{Name: <span class="string">"Alice Updated"</span>, Age: <span class="number">26</span>})

<span class="comment">// åªæ›´æ–°éé›¶å­—æ®µ</span>
db.<span class="function">Model</span>(&user).<span class="function">Updates</span>(User{Name: <span class="string">"Alice"</span>})

<span class="comment">// æ›´æ–°æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬é›¶å€¼ï¼‰</span>
db.<span class="function">Model</span>(&user).<span class="function">Select</span>(<span class="string">"*"</span>).<span class="function">Updates</span>(User{Name: <span class="string">""</span>, Age: <span class="number">0</span>})

<span class="comment">// æ¡ä»¶æ›´æ–°</span>
db.<span class="function">Model</span>(&User{}).<span class="function">Where</span>(<span class="string">"age > ?"</span>, <span class="number">20</span>).<span class="function">Update</span>(<span class="string">"status"</span>, <span class="string">"active"</span>)

<span class="comment">// æ‰¹é‡æ›´æ–°</span>
db.<span class="function">Model</span>(&User{}).<span class="function">Where</span>(<span class="string">"age > ?"</span>, <span class="number">20</span>).<span class="function">Updates</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>{}{<span class="string">"status"</span>: <span class="string">"active"</span>})</code></pre>
            
            <h3>åˆ é™¤è®°å½•</h3>
            <pre><code><span class="comment">// åˆ é™¤è®°å½•</span>
db.<span class="function">Delete</span>(&user)
<span class="comment">// DELETE FROM users WHERE id = 1;</span>

<span class="comment">// æ ¹æ®ä¸»é”®åˆ é™¤</span>
db.<span class="function">Delete</span>(&User{}, <span class="number">1</span>)

<span class="comment">// æ‰¹é‡åˆ é™¤</span>
db.<span class="function">Where</span>(<span class="string">"age < ?"</span>, <span class="number">18</span>).<span class="function">Delete</span>(&User{})

<span class="comment">// è½¯åˆ é™¤</span>
<span class="keyword">type</span> User <span class="keyword">struct</span> {
    ID        <span class="keyword">uint</span>
    Name      <span class="keyword">string</span>
    DeletedAt gorm.DeletedAt <span class="string">`gorm:"index"`</span>
}
<span class="comment">// è½¯åˆ é™¤ä¸ä¼šçœŸæ­£åˆ é™¤è®°å½•ï¼Œè€Œæ˜¯è®¾ç½® deleted_at å­—æ®µ</span>

<span class="comment">// æ°¸ä¹…åˆ é™¤</span>
db.<span class="function">Unscoped</span>().<span class="function">Delete</span>(&user)</code></pre>
            
            <h3>å…³è”</h3>
            <pre><code><span class="keyword">type</span> User <span class="keyword">struct</span> {
    gorm.Model
    Name   <span class="keyword">string</span>
    Posts  []Post
}

<span class="keyword">type</span> Post <span class="keyword">struct</span> {
    gorm.Model
    Title   <span class="keyword">string</span>
    UserID  <span class="keyword">uint</span>
    User    User
}

<span class="comment">// é¢„åŠ è½½å…³è”</span>
<span class="keyword">var</span> users []User
db.<span class="function">Preload</span>(<span class="string">"Posts"</span>).<span class="function">Find</span>(&users)

<span class="comment">// åˆ›å»ºå…³è”</span>
user := User{Name: <span class="string">"Alice"</span>}
db.<span class="function">Create</span>(&user)
db.<span class="function">Model</span>(&user).<span class="function">Association</span>(<span class="string">"Posts"</span>).<span class="function">Append</span>([]Post{
    {Title: <span class="string">"Post 1"</span>},
    {Title: <span class="string">"Post 2"</span>},
})

<span class="comment">// æŸ¥æ‰¾å…³è”</span>
<span class="keyword">var</span> posts []Post
db.<span class="function">Model</span>(&user).<span class="function">Association</span>(<span class="string">"Posts"</span>).<span class="function">Find</span>(&posts)

<span class="comment">// æ›¿æ¢å…³è”</span>
db.<span class="function">Model</span>(&user).<span class="function">Association</span>(<span class="string">"Posts"</span>).<span class="function">Replace</span>([]Post{
    {Title: <span class="string">"New Post 1"</span>},
})

<span class="comment">// åˆ é™¤å…³è”</span>
db.<span class="function">Model</span>(&user).<span class="function">Association</span>(<span class="string">"Posts"</span>).<span class="function">Delete</span>(posts)

<span class="comment">// æ¸…ç©ºå…³è”</span>
db.<span class="function">Model</span>(&user).<span class="function">Association</span>(<span class="string">"Posts"</span>).<span class="function">Clear</span>()</code></pre>
            
            <h3>é’©å­</h3>
            <pre><code><span class="keyword">type</span> User <span class="keyword">struct</span> {
    gorm.Model
    Name  <span class="keyword">string</span>
    Email <span class="keyword">string</span>
}

<span class="comment">// åˆ›å»ºå‰é’©å­</span>
<span class="function">func</span> (u *User) <span class="function">BeforeCreate</span>(tx *gorm.DB) <span class="keyword">error</span> {
    fmt.<span class="function">Println</span>(<span class="string">"Before create:"</span>, u.Name)
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="comment">// åˆ›å»ºåé’©å­</span>
<span class="function">func</span> (u *User) <span class="function">AfterCreate</span>(tx *gorm.DB) <span class="keyword">error</span> {
    fmt.<span class="function">Println</span>(<span class="string">"After create:"</span>, u.ID)
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="comment">// æ›´æ–°å‰é’©å­</span>
<span class="function">func</span> (u *User) <span class="function">BeforeUpdate</span>(tx *gorm.DB) <span class="keyword">error</span> {
    fmt.<span class="function">Println</span>(<span class="string">"Before update:"</span>, u.Name)
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="comment">// æŸ¥è¯¢å‰é’©å­</span>
<span class="function">func</span> (u *User) <span class="function">AfterFind</span>(tx *gorm.DB) <span class="keyword">error</span> {
    fmt.<span class="function">Println</span>(<span class="string">"After find:"</span>, u.Name)
    <span class="keyword">return</span> <span class="keyword">nil</span>
}</code></pre>
            
            <h3>äº‹åŠ¡</h3>
            <pre><code><span class="comment">// è‡ªåŠ¨äº‹åŠ¡</span>
err := db.<span class="function">Transaction</span>(<span class="keyword">func</span>(tx *gorm.DB) <span class="keyword">error</span> {
    <span class="comment">// åˆ›å»ºç”¨æˆ·</span>
    <span class="keyword">if</span> err := tx.<span class="function">Create</span>(&User{Name: <span class="string">"Alice"</span>}).Error; err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    
    <span class="comment">// åˆ›å»ºè®¢å•</span>
    <span class="keyword">if</span> err := tx.<span class="function">Create</span>(&Order{UserID: <span class="number">1</span>}).Error; err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    
    <span class="keyword">return</span> <span class="keyword">nil</span>
})

<span class="comment">// æ‰‹åŠ¨äº‹åŠ¡</span>
tx := db.<span class="function">Begin</span>()

<span class="keyword">if</span> err := tx.<span class="function">Create</span>(&User{Name: <span class="string">"Bob"</span>}).Error; err != <span class="keyword">nil</span> {
    tx.<span class="function">Rollback</span>()
}

<span class="keyword">if</span> err := tx.<span class="function">Commit</span>().Error; err != <span class="keyword">nil</span> {
    tx.<span class="function">Rollback</span>()
}</code></pre>
            
            
        </div>
    </div>
<script src="code-collapse.js"></script>

</body>
    <script src="navigation.js"></script>
</html>