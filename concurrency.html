<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¶å‘ - Go å­¦ä¹ æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scroll.js"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h3>ğŸ“š å­¦ä¹ ç›®å½•</h3>
            <ul>
                <li><a href="index.html">ğŸ  é¦–é¡µ</a></li>
                <li>
                    <a href="introduction.html">ğŸ“– Go è¯­è¨€ç®€ä»‹</a>
                </li>
                <li>
                    <a href="basics.html">ğŸ”¤ åŸºç¡€è¯­æ³•</a>
                    <ul>
                        <li><a href="basics.html#variables">å˜é‡å£°æ˜</a></li>
                        <li><a href="basics.html#datatypes">æ•°æ®ç±»å‹</a></li>
                        <li><a href="basics.html#arrays">æ•°ç»„ä¸åˆ‡ç‰‡</a></li>
                        <li><a href="basics.html#maps">æ˜ å°„</a></li>
                        <li><a href="basics.html#go125">Go 1.25 æ–°ç‰¹æ€§</a></li>
                    </ul>
                </li>
                <li>
                    <a href="control-flow.html">ğŸ”„ æ§åˆ¶æµ</a>
                    <ul>
                        <li><a href="control-flow.html#if">if è¯­å¥</a></li>
                        <li><a href="control-flow.html#switch">switch è¯­å¥</a></li>
                        <li><a href="control-flow.html#for">for å¾ªç¯</a></li>
                        <li><a href="control-flow.html#defer">defer è¯­å¥</a></li>
                    </ul>
                </li>
                <li>
                    <a href="functions.html">âš¡ å‡½æ•°</a>
                    <ul>
                        <li><a href="functions.html#basic">åŸºæœ¬å‡½æ•°</a></li>
                        <li><a href="functions.html#multiple">å¤šè¿”å›å€¼</a></li>
                        <li><a href="functions.html#variadic">å¯å˜å‚æ•°</a></li>
                        <li><a href="functions.html#closure">é—­åŒ…</a></li>
                        <li><a href="functions.html#methods">æ–¹æ³•</a></li>
                    </ul>
                </li>
                <li>
                    <a href="structs.html">ğŸ—ï¸ ç»“æ„ä½“ä¸æ¥å£</a>
                    <ul>
                        <li><a href="structs.html#struct">ç»“æ„ä½“</a></li>
                        <li><a href="structs.html#nested">åµŒå¥—ç»“æ„ä½“</a></li>
                        <li><a href="structs.html#methods">ç»“æ„ä½“æ–¹æ³•</a></li>
                        <li><a href="structs.html#interface">æ¥å£</a></li>
                        <li><a href="structs.html#tags">ç»“æ„ä½“æ ‡ç­¾</a></li>
                    </ul>
                </li>
                <li>
                    <a href="concurrency.html" class="active">ğŸš€ å¹¶å‘ç¼–ç¨‹</a>
                    <ul>
                        <li><a href="concurrency.html#goroutine">Goroutine</a></li>
                        <li><a href="concurrency.html#channel">Channel</a></li>
                        <li><a href="concurrency.html#select">Select</a></li>
                        <li><a href="concurrency.html#mutex">äº’æ–¥é”</a></li>
                        <li><a href="concurrency.html#context">Context</a></li>
                    </ul>
                </li>
                <li>
                    <a href="generics.html">ğŸ§© æ³›å‹</a>
                    <ul>
                        <li><a href="generics.html#functions">æ³›å‹å‡½æ•°</a></li>
                        <li><a href="generics.html#types">æ³›å‹ç±»å‹</a></li>
                        <li><a href="generics.html#constraints">ç±»å‹çº¦æŸ</a></li>
                        <li><a href="generics.html#inference">ç±»å‹æ¨æ–­</a></li>
                    </ul>
                </li>
                <li>
                    <a href="reflection.html">ğŸ” åå°„</a>
                    <ul>
                        <li><a href="reflection.html#typevalue">Type å’Œ Value</a></li>
                        <li><a href="reflection.html#struct">ç»“æ„ä½“åå°„</a></li>
                        <li><a href="reflection.html#modify">ä¿®æ”¹å€¼</a></li>
                        <li><a href="reflection.html#methods">è°ƒç”¨æ–¹æ³•</a></li>
                        <li><a href="reflection.html#performance">æ€§èƒ½è€ƒè™‘</a></li>
                    </ul>
                </li>
            </ul>
        </aside>
        <div class="content">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>å¹¶å‘</h1>

            <h2 id="goroutine">Goroutine</h2>
            <p>Goroutine æ˜¯ Go è¯­è¨€è½»é‡çº§çš„çº¿ç¨‹å®ç°ï¼Œç”± Go è¿è¡Œæ—¶ç®¡ç†ã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">say</span>(s <span class="keyword">string</span>) {
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {
        time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
        fmt.<span class="function">Println</span>(s)
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// å¯åŠ¨ goroutine</span>
    <span class="keyword">go</span> <span class="function">say</span>(<span class="string">"world"</span>)
    <span class="function">say</span>(<span class="string">"hello"</span>)
}</code></pre>

            <h2 id="channel">Channel</h2>
            <p>Channel æ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„ç®¡é“ã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">sum</span>(s []<span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>) {
    sum := <span class="number">0</span>
    <span class="keyword">for</span> _, v := <span class="keyword">range</span> s {
        sum += v
    }
    c &lt;- sum <span class="comment">// å°†å’Œå‘é€åˆ° channel</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    s := []<span class="keyword">int</span>{<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, -<span class="number">9</span>, <span class="number">4</span>, <span class="number">0</span>}

    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    <span class="keyword">go</span> <span class="function">sum</span>(s[:<span class="function">len</span>(s)/<span class="number">2</span>], c)
    <span class="keyword">go</span> <span class="function">sum</span>(s[<span class="function">len</span>(s)/<span class="number">2</span>:], c)
    x, y := &lt;-c, &lt;-c <span class="comment">// ä» channel æ¥æ”¶</span>

    fmt.<span class="function">Println</span>(x, y, x+y)
}</code></pre>

            <h2 id="buffered">Buffered Channel</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ›å»ºå¸¦ç¼“å†²çš„ channel</span>
    ch := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)

    ch &lt;- <span class="number">1</span>
    ch &lt;- <span class="number">2</span>

    fmt.<span class="function">Println</span>(&lt;-ch)
    fmt.<span class="function">Println</span>(&lt;-ch)
}</code></pre>

            <h2 id="range">Range å’Œ Close</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">fibonacci</span>(n <span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>) {
    x, y := <span class="number">0</span>, <span class="number">1</span>
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ {
        c &lt;- x
        x, y = y, x+y
    }
    <span class="keyword">close</span>(c) <span class="comment">// å…³é—­ channel</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)
    <span class="keyword">go</span> <span class="function">fibonacci</span>(<span class="number">cap</span>(c), c)

    <span class="comment">// range ä¼šæŒç»­ä» channel æ¥æ”¶ï¼Œç›´åˆ° channel è¢«å…³é—­</span>
    <span class="keyword">for</span> i := <span class="keyword">range</span> c {
        fmt.<span class="function">Println</span>(i)
    }
}</code></pre>

            <h2 id="select">Select</h2>
            <p>Select è¯­å¥è®© goroutine å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">fibonacci</span>(c, quit <span class="keyword">chan</span> <span class="keyword">int</span>) {
    x, y := <span class="number">0</span>, <span class="number">1</span>
    <span class="keyword">for</span> {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> c &lt;- x:
            x, y = y, x+y
        <span class="keyword">case</span> &lt;-quit:
            fmt.<span class="function">Println</span>(<span class="string">"quit"</span>)
            <span class="keyword">return</span>
        }
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    quit := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)

    <span class="keyword">go</span> <span class="function">func</span>() {
        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {
            fmt.<span class="function">Println</span>(&lt;-c)
        }
        quit &lt;- <span class="number">0</span>
    }()

    <span class="function">fibonacci</span>(c, quit)
}</code></pre>

            <h2 id="default">é»˜è®¤é€‰æ‹©</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">main</span>() {
    tick := time.<span class="function">Tick</span>(<span class="number">100</span> * time.Millisecond)
    boom := time.<span class="function">After</span>(<span class="number">500</span> * time.Millisecond)

    <span class="keyword">for</span> {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> &lt;-tick:
            fmt.<span class="function">Println</span>(<span class="string">"tick."</span>)
        <span class="keyword">case</span> &lt;-boom:
            fmt.<span class="function">Println</span>(<span class="string">"BOOM!"</span>)
            <span class="keyword">return</span>
        <span class="keyword">default</span>:
            fmt.<span class="function">Println</span>(<span class="string">"    ."</span>)
            time.<span class="function">Sleep</span>(<span class="number">50</span> * time.Millisecond)
        }
    }
}</code></pre>

            <h2 id="mutex">äº’æ–¥é”ï¼ˆMutexï¼‰</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="comment">// SafeCounter æ˜¯å¹¶å‘å®‰å…¨çš„è®¡æ•°å™¨</span>
<span class="keyword">type</span> SafeCounter <span class="keyword">struct</span> {
    mu sync.Mutex
    v  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>
}

<span class="function">func</span> (c *SafeCounter) <span class="function">Inc</span>(key <span class="keyword">string</span>) {
    c.mu.<span class="function">Lock</span>()
    <span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span>
    c.v[key]++
    c.mu.<span class="function">Unlock</span>()
}

<span class="function">func</span> (c *SafeCounter) <span class="function">Value</span>(key <span class="keyword">string</span>) <span class="keyword">int</span> {
    c.mu.<span class="function">Lock</span>()
    <span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span>
    <span class="keyword">defer</span> c.mu.<span class="function">Unlock</span>()
    <span class="keyword">return</span> c.v[key]
}

<span class="function">func</span> <span class="function">main</span>() {
    c := SafeCounter{v: <span class="function">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)}

    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ {
        <span class="keyword">go</span> c.<span class="function">Inc</span>(<span class="string">"somekey"</span>)
    }

    time.<span class="function">Sleep</span>(time.Second)
    fmt.<span class="function">Println</span>(c.<span class="function">Value</span>(<span class="string">"somekey"</span>))
}</code></pre>

            <h2 id="waitgroup">WaitGroup</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">worker</span>(id <span class="keyword">int</span>, wg *sync.WaitGroup) {
    <span class="keyword">defer</span> wg.<span class="function">Done</span>()

    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å¼€å§‹å·¥ä½œ\n"</span>, id)
    time.<span class="function">Sleep</span>(time.Second)
    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å®Œæˆå·¥ä½œ\n"</span>, id)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> wg sync.WaitGroup

    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="function">worker</span>(i, &amp;wg)
    }

    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ worker å®Œæˆ"</span>)
}</code></pre>

            <h2 id="context">Context</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ context</span>
    ctx, cancel := context.<span class="function">WithCancel</span>(context.<span class="function">Background</span>())

    <span class="keyword">go</span> <span class="function">func</span>() {
        <span class="keyword">for</span> {
            <span class="keyword">select</span> {
            <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
                fmt.<span class="function">Println</span>(<span class="string">"goroutine è¢«å–æ¶ˆ"</span>)
                <span class="keyword">return</span>
            <span class="keyword">default</span>:
                fmt.<span class="function">Println</span>(<span class="string">"goroutine è¿è¡Œä¸­"</span>)
                time.<span class="function">Sleep</span>(<span class="number">500</span> * time.Millisecond)
            }
        }
    }()

    time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
    fmt.<span class="function">Println</span>(<span class="string">"å–æ¶ˆ goroutine"</span>)
    <span class="function">cancel</span>()
    time.<span class="function">Sleep</span>(time.Second)
}</code></pre>

            <h2 id="timeout">è¶…æ—¶æ§åˆ¶</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">longRunningTask</span>(ctx context.Context) {
    <span class="keyword">select</span> {
    <span class="keyword">case</span> &lt;-time.<span class="function">After</span>(<span class="number">5</span> * time.Second):
        fmt.<span class="function">Println</span>(<span class="string">"ä»»åŠ¡å®Œæˆ"</span>)
    <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
        fmt.<span class="function">Println</span>(<span class="string">"ä»»åŠ¡è¶…æ—¶:"</span>, ctx.<span class="function">Err</span>())
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è®¾ç½® 2 ç§’è¶…æ—¶</span>
    ctx, cancel := context.<span class="function">WithTimeout</span>(context.<span class="function">Background</span>(), <span class="number">2</span>*time.Second)
    <span class="keyword">defer</span> <span class="function">cancel</span>()

    <span class="function">longRunningTask</span>(ctx)
}</code></pre>
        </div>
    </div>
</body>
</html>