<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¶å‘ - Go å­¦ä¹ æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scroll.js"></script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h3>ğŸ“š å­¦ä¹ ç›®å½•</h3>
            <ul>
                <li><a href="index.html">ğŸ  é¦–é¡µ</a></li>
                <li>
                    <a href="introduction.html">ğŸ“– Go è¯­è¨€ç®€ä»‹</a>
                </li>
                <li>
                    <a href="basics.html">ğŸ”¤ åŸºç¡€è¯­æ³•</a>
                    <ul>
                        <li><a href="basics.html#variables">å˜é‡å£°æ˜</a></li>
                        <li><a href="basics.html#datatypes">æ•°æ®ç±»å‹</a></li>
                        <li><a href="basics.html#arrays">æ•°ç»„ä¸åˆ‡ç‰‡</a></li>
                        <li><a href="basics.html#maps">æ˜ å°„</a></li>
                        <li><a href="basics.html#go125">Go 1.25 æ–°ç‰¹æ€§</a></li>
                    </ul>
                </li>
                <li>
                    <a href="control-flow.html">ğŸ”„ æ§åˆ¶æµ</a>
                    <ul>
                        <li><a href="control-flow.html#if">if è¯­å¥</a></li>
                        <li><a href="control-flow.html#switch">switch è¯­å¥</a></li>
                        <li><a href="control-flow.html#for">for å¾ªç¯</a></li>
                        <li><a href="control-flow.html#defer">defer è¯­å¥</a></li>
                    </ul>
                </li>
                <li>
                    <a href="functions.html">âš¡ å‡½æ•°</a>
                    <ul>
                        <li><a href="functions.html#basic">åŸºæœ¬å‡½æ•°</a></li>
                        <li><a href="functions.html#multiple">å¤šè¿”å›å€¼</a></li>
                        <li><a href="functions.html#variadic">å¯å˜å‚æ•°</a></li>
                        <li><a href="functions.html#closure">é—­åŒ…</a></li>
                        <li><a href="functions.html#methods">æ–¹æ³•</a></li>
                    </ul>
                </li>
                <li>
                    <a href="structs.html">ğŸ—ï¸ ç»“æ„ä½“ä¸æ¥å£</a>
                    <ul>
                        <li><a href="structs.html#struct">ç»“æ„ä½“</a></li>
                        <li><a href="structs.html#nested">åµŒå¥—ç»“æ„ä½“</a></li>
                        <li><a href="structs.html#methods">ç»“æ„ä½“æ–¹æ³•</a></li>
                        <li><a href="structs.html#interface">æ¥å£</a></li>
                        <li><a href="structs.html#tags">ç»“æ„ä½“æ ‡ç­¾</a></li>
                    </ul>
                </li>
                <li>
                    <a href="concurrency.html" class="active">ğŸš€ å¹¶å‘ç¼–ç¨‹</a>
                    <ul>
                        <li><a href="concurrency.html#goroutine">Goroutine</a></li>
                        <li><a href="concurrency.html#channel">Channel</a></li>
                        <li><a href="concurrency.html#select">Select</a></li>
                        <li><a href="concurrency.html#mutex">äº’æ–¥é”</a></li>
                        <li><a href="concurrency.html#context">Context</a></li>
                    </ul>
                </li>
                <li>
                    <a href="generics.html">ğŸ§© æ³›å‹</a>
                    <ul>
                        <li><a href="generics.html#functions">æ³›å‹å‡½æ•°</a></li>
                        <li><a href="generics.html#types">æ³›å‹ç±»å‹</a></li>
                        <li><a href="generics.html#constraints">ç±»å‹çº¦æŸ</a></li>
                        <li><a href="generics.html#inference">ç±»å‹æ¨æ–­</a></li>
                    </ul>
                </li>
                <li>
                    <a href="reflection.html">ğŸ” åå°„</a>
                    <ul>
                        <li><a href="reflection.html#typevalue">Type å’Œ Value</a></li>
                        <li><a href="reflection.html#struct">ç»“æ„ä½“åå°„</a></li>
                        <li><a href="reflection.html#modify">ä¿®æ”¹å€¼</a></li>
                        <li><a href="reflection.html#methods">è°ƒç”¨æ–¹æ³•</a></li>
                        <li><a href="reflection.html#performance">æ€§èƒ½è€ƒè™‘</a></li>
                    </ul>
                </li>
            </ul>
        </aside>
        <div class="content">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>å¹¶å‘</h1>

            <h2 id="goroutine">Goroutine</h2>
            <p>Goroutine æ˜¯ Go è¯­è¨€è½»é‡çº§çš„çº¿ç¨‹å®ç°ï¼Œç”± Go è¿è¡Œæ—¶ç®¡ç†ã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">say</span>(s <span class="keyword">string</span>) {
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {
        time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
        fmt.<span class="function">Println</span>(s)
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// å¯åŠ¨ goroutine</span>
    <span class="keyword">go</span> <span class="function">say</span>(<span class="string">"world"</span>)
    <span class="function">say</span>(<span class="string">"hello"</span>)
}</code></pre>

            <div class="note-box">
                <h3>Goroutine å†…éƒ¨å®ç°åŸç†</h3>
                <p><strong>1. Goroutine çš„å†…éƒ¨ç»“æ„ï¼š</strong></p>
                <p>Goroutine æ˜¯ Go è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ï¼Œå…¶å†…éƒ¨ç»“æ„åŒ…å«ï¼š</p>
                <pre><code><span class="comment">// Goroutine çš„å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="keyword">type</span> g <span class="keyword">struct</span> {
    stack       stack   <span class="comment">// æ ˆå†…å­˜</span>
    stackguard0 uintptr <span class="comment">// æ ˆæº¢å‡ºæ£€æŸ¥</span>
    m           *m      <span class="comment">// å…³è”çš„ Mï¼ˆMachineï¼‰</span>
    sched       gobuf   <span class="comment">// è°ƒåº¦ä¿¡æ¯</span>
    goid        int64   <span class="comment">// Goroutine ID</span>
    gopc        uintptr <span class="comment">// åˆ›å»ºè¯¥ goroutine çš„ PC</span>
    startpc     uintptr <span class="comment">// goroutine å‡½æ•°çš„èµ·å§‹ PC</span>
    atomicstatus uint32 <span class="comment">// åŸå­çŠ¶æ€</span>
    goid        int64   <span class="comment">// Goroutine å”¯ä¸€æ ‡è¯†</span>
}</code></pre>

                <p><strong>2. Mï¼ˆMachineï¼‰ç»“æ„ï¼š</strong></p>
                <p>M ä»£è¡¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè´Ÿè´£æ‰§è¡Œ goroutineï¼š</p>
                <pre><code><span class="comment">// M çš„å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="keyword">type</span> m <span class="keyword">struct</span> {
    g0      *g      <span class="comment">// è°ƒåº¦ç”¨çš„ goroutine</span>
    curg    *g      <span class="comment">// å½“å‰è¿è¡Œçš„ goroutine</span>
    p       *p      <span class="comment">// å…³è”çš„ Pï¼ˆProcessorï¼‰</span>
    nextp   *p      <span class="comment">// ä¸‹ä¸€ä¸ª P</span>
    id      int64   <span class="comment">// M çš„ ID</span>
    spinning <span class="keyword">bool</span>   <span class="comment">// æ˜¯å¦åœ¨è‡ªæ—‹å¯»æ‰¾å·¥ä½œ</span>
    blocked <span class="keyword">bool</span>   <span class="comment">// æ˜¯å¦é˜»å¡</span>
}</code></pre>

                <p><strong>3. Pï¼ˆProcessorï¼‰ç»“æ„ï¼š</strong></p>
                <p>P ä»£è¡¨å¤„ç†å™¨ï¼Œç»´æŠ¤ä¸€ä¸ªæœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼š</p>
                <pre><code><span class="comment">// P çš„å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="keyword">type</span> p <span class="keyword">struct</span> {
    id          int32
    status      uint32
    link        *p
    schedtick   uint32
    syscalltick uint32
    m           *m      <span class="comment">// å…³è”çš„ M</span>
    mcache      *mcache <span class="comment">// å†…å­˜åˆ†é…ç¼“å­˜</span>
    runqhead    uint32
    runqtail    uint32
    runq        [<span class="number">256</span>]<span class="keyword">guintptr</span> <span class="comment">// æœ¬åœ°è¿è¡Œé˜Ÿåˆ—</span>
    runnext     guintptr <span class="comment">// ä¸‹ä¸€ä¸ªè¿è¡Œçš„ goroutine</span>
}</code></pre>

                <p><strong>4. GMP è°ƒåº¦æ¨¡å‹ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">worker</span>(id <span class="keyword">int</span>, wg *sync.WaitGroup) {
    <span class="keyword">defer</span> wg.<span class="function">Done</span>()
    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å¼€å§‹å·¥ä½œ\n"</span>, id)
    time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å®Œæˆå·¥ä½œ\n"</span>, id)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è®¾ç½®ä½¿ç”¨çš„ P æ•°é‡</span>
    runtime.<span class="function">GOMAXPROCS</span>(<span class="number">4</span>)
    
    fmt.<span class="function">Printf</span>(<span class="string">"CPU æ ¸å¿ƒæ•°: %d\n"</span>, runtime.<span class="function">NumCPU</span>())
    fmt.<span class="function">Printf</span>(<span class="string">"GOMAXPROCS: %d\n"</span>, runtime.<span class="function">GOMAXPROCS</span>(<span class="number">0</span>))
    
    <span class="keyword">var</span> wg sync.WaitGroup
    
    <span class="comment">// å¯åŠ¨å¤šä¸ª goroutine</span>
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="function">worker</span>(i, &amp;wg)
    }
    
    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ worker å®Œæˆ"</span>)
}</code></pre>

                <p><strong>5. Goroutine è°ƒåº¦è¿‡ç¨‹ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
)

<span class="function">func</span> <span class="function">task</span>(id <span class="keyword">int</span>) {
    fmt.<span class="function">Printf</span>(<span class="string">"Task %d åœ¨ P%d ä¸Šè¿è¡Œ\n"</span>, id, runtime.<span class="function">GOMAXPROCS</span>(<span class="number">0</span>))
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// Goroutine è°ƒåº¦è¿‡ç¨‹ï¼š</span>
    <span class="comment">// 1. åˆ›å»º goroutineï¼šgo func() {}</span>
    <span class="comment">// 2. å°† goroutine æ”¾å…¥æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼ˆP çš„ runqï¼‰</span>
    <span class="comment">// 3. M ä» P çš„ runq ä¸­è·å– goroutine æ‰§è¡Œ</span>
    <span class="comment">// 4. å¦‚æœ P çš„ runq ä¸ºç©ºï¼Œä»å…¨å±€é˜Ÿåˆ—æˆ–å…¶ä»– P çªƒå– goroutine</span>
    <span class="comment">// 5. Goroutine æ‰§è¡Œå®Œæˆæˆ–é˜»å¡ï¼ŒM ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª goroutine</span>
    
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {
        <span class="keyword">go</span> <span class="function">task</span>(i)
    }
    
    <span class="comment">// ç­‰å¾… goroutine å®Œæˆ</span>
    <span class="keyword">select</span> {}
}</code></pre>

                <p><strong>6. å·¥ä½œçªƒå–ï¼ˆWork Stealingï¼‰ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">heavyTask</span>(id <span class="keyword">int</span>, wg *sync.WaitGroup) {
    <span class="keyword">defer</span> wg.<span class="function">Done</span>()
    
    <span class="comment">// æ¨¡æ‹Ÿä¸åŒè´Ÿè½½çš„ä»»åŠ¡</span>
    duration := time.Duration(<span class="number">50</span>+id*<span class="number">10</span>) * time.Millisecond
    time.<span class="function">Sleep</span>(duration)
    
    fmt.<span class="function">Printf</span>(<span class="string">"Task %d å®Œæˆï¼Œè€—æ—¶ %v\n"</span>, id, duration)
}

<span class="function">func</span> <span class="function">main</span>() {
    runtime.<span class="function">GOMAXPROCS</span>(<span class="number">2</span>) <span class="comment">// ä½¿ç”¨ 2 ä¸ª P</span>
    
    <span class="keyword">var</span> wg sync.WaitGroup
    
    <span class="comment">// åˆ›å»ºä¸åŒè´Ÿè½½çš„ä»»åŠ¡</span>
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="function">heavyTask</span>(i, &amp;wg)
    }
    
    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ä»»åŠ¡å®Œæˆ"</span>)
    
    <span class="comment">// å·¥ä½œçªƒå–æœºåˆ¶ï¼š</span>
    <span class="comment">// 1. P1 çš„ä»»åŠ¡è¾ƒå¤šï¼ŒP2 çš„ä»»åŠ¡è¾ƒå°‘</span>
    <span class="comment">// 2. P2 å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œä¼šä» P1 çªƒå–ä»»åŠ¡æ‰§è¡Œ</span>
    <span class="comment">// 3. è¿™å®ç°äº†è´Ÿè½½å‡è¡¡ï¼Œå……åˆ†åˆ©ç”¨ CPU èµ„æº</span>
}</code></pre>

                <p><strong>7. Goroutine æ ˆç®¡ç†ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
)

<span class="function">func</span> <span class="function">recursive</span>(depth <span class="keyword">int</span>) {
    <span class="keyword">var</span> buf [<span class="number">1024</span>]<span class="keyword">byte</span> <span class="comment">// åˆ†é… 1KB æ ˆç©ºé—´</span>
    
    <span class="keyword">if</span> depth &lt; <span class="number">100</span> {
        fmt.<span class="function">Printf</span>(<span class="string">"é€’å½’æ·±åº¦: %d, æ ˆåœ°å€: %p\n"</span>, depth, &amp;buf)
        <span class="function">recursive</span>(depth + <span class="number">1</span>)
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Printf</span>(<span class="string">"åˆå§‹æ ˆå¤§å°: %d KB\n"</span>, runtime.<span class="function">GoroutineStack</span>()/<span class="number">1024</span>)
    
    <span class="comment">// Goroutine æ ˆç®¡ç†ç‰¹ç‚¹ï¼š</span>
    <span class="comment">// 1. åˆå§‹æ ˆå¤§å°ï¼š2KBï¼ˆGo 1.4+ï¼‰</span>
    <span class="comment">// 2. åŠ¨æ€å¢é•¿ï¼šæ ˆç©ºé—´ä¸è¶³æ—¶è‡ªåŠ¨æ‰©å®¹</span>
    <span class="comment">// 3. æœ€å¤§æ ˆå¤§å°ï¼š1GBï¼ˆå¯é…ç½®ï¼‰</span>
    <span class="comment">// 4. æ ˆæ‹·è´ï¼šæ‰©å®¹æ—¶å°†æ—§æ ˆå†…å®¹æ‹·è´åˆ°æ–°æ ˆ</span>
    
    <span class="keyword">go</span> <span class="function">recursive</span>(<span class="number">0</span>)
    
    <span class="keyword">select</span> {}
}</code></pre>

                <p><strong>8. Goroutine çŠ¶æ€è½¬æ¢ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">demonstrateStates</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"Goroutine çŠ¶æ€è½¬æ¢ï¼š"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Gidle: åˆšåˆ›å»ºï¼Œæœªåˆå§‹åŒ–"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Grunnable: åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ‰§è¡Œ"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Grunning: æ­£åœ¨æ‰§è¡Œ"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Gsyscall: æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Gwaiting: ç­‰å¾…ï¼ˆchannelã€sleep ç­‰ï¼‰"</span>)
    fmt.<span class="function">Println</span>(<span class="string">"_Gdead: å·²é€€å‡º"</span>)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">go</span> <span class="function">demonstrateStates</span>()
    
    <span class="comment">// Goroutine çŠ¶æ€è½¬æ¢ç¤ºä¾‹ï¼š</span>
    <span class="comment">// _Gidle -> _Grunnable: åˆ›å»º goroutine</span>
    <span class="comment">// _Grunnable -> _Grunning: è¢«è°ƒåº¦æ‰§è¡Œ</span>
    <span class="comment">// _Grunning -> _Gwaiting: ç­‰å¾… channel æˆ– sleep</span>
    <span class="comment">// _Gwaiting -> _Grunnable: å”¤é†’åé‡æ–°è¿›å…¥é˜Ÿåˆ—</span>
    <span class="comment">// _Grunning -> _Gdead: æ‰§è¡Œå®Œæˆ</span>
    
    time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
}</code></pre>
            </div>

            <div class="example-box">
                <h3>Goroutine æœ€ä½³å®è·µ</h3>
                <p><strong>1. åˆç†æ§åˆ¶ Goroutine æ•°é‡ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="comment">// ä½¿ç”¨ worker pool æ¨¡å¼é™åˆ¶ goroutine æ•°é‡</span>
<span class="keyword">type</span> WorkerPool <span class="keyword">struct</span> {
    tasks   <span class="keyword">chan</span> <span class="keyword">int</span>
    workers <span class="keyword">int</span>
    wg      sync.WaitGroup
}

<span class="function">func</span> <span class="function">NewWorkerPool</span>(workers <span class="keyword">int</span>) *WorkerPool {
    <span class="keyword">return</span> &amp;WorkerPool{
        tasks:   <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>),
        workers: workers,
    }
}

<span class="function">func</span> (wp *WorkerPool) <span class="function">Start</span>() {
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; wp.workers; i++ {
        wp.wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> wp.<span class="function">worker</span>(i)
    }
}

<span class="function">func</span> (wp *WorkerPool) <span class="function">worker</span>(id <span class="keyword">int</span>) {
    <span class="keyword">defer</span> wp.wg.<span class="function">Done</span>()
    <span class="keyword">for</span> task := <span class="keyword">range</span> wp.tasks {
        fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å¤„ç†ä»»åŠ¡ %d\n"</span>, id, task)
        time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
    }
}

<span class="function">func</span> (wp *WorkerPool) <span class="function">Submit</span>(task <span class="keyword">int</span>) {
    wp.tasks &lt;- task
}

<span class="function">func</span> (wp *WorkerPool) <span class="function">Stop</span>() {
    <span class="keyword">close</span>(wp.tasks)
    wp.wg.<span class="function">Wait</span>()
}

<span class="function">func</span> <span class="function">main</span>() {
    pool := <span class="function">NewWorkerPool</span>(<span class="number">5</span>) <span class="comment">// é™åˆ¶ä¸º 5 ä¸ª worker</span>
    pool.<span class="function">Start</span>()
    
    <span class="comment">// æäº¤ 20 ä¸ªä»»åŠ¡</span>
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++ {
        pool.<span class="function">Submit</span>(i)
    }
    
    pool.<span class="function">Stop</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ä»»åŠ¡å®Œæˆ"</span>)
}</code></pre>

                <p><strong>2. é¿å… Goroutine æ³„éœ²ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šgoroutine æ³„éœ²</span>
<span class="function">func</span> <span class="function">leak</span>() {
    ch := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    <span class="keyword">go</span> <span class="keyword">func</span>() {
        val := &lt;-ch <span class="comment">// æ°¸è¿œé˜»å¡ï¼Œgoroutine æ³„éœ²</span>
        fmt.<span class="function">Println</span>(val)
    }()
}

<span class="comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨ context æ§åˆ¶</span>
<span class="keyword">import</span> <span class="string">"context"</span>

<span class="function">func</span> <span class="function">noLeak</span>(ctx context.Context) {
    ch := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    <span class="keyword">go</span> <span class="keyword">func</span>() {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> val := &lt;-ch:
            fmt.<span class="function">Println</span>(val)
        <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
            fmt.<span class="function">Println</span>(<span class="string">"goroutine è¢«å–æ¶ˆ"</span>)
            <span class="keyword">return</span>
        }
    }()
}

<span class="function">func</span> <span class="function">main</span>() {
    ctx, cancel := context.<span class="function">WithTimeout</span>(context.<span class="function">Background</span>(), <span class="number">2</span>*time.Second)
    <span class="keyword">defer</span> cancel()
    
    <span class="function">noLeak</span>(ctx)
    time.<span class="function">Sleep</span>(<span class="number">3</span> * time.Second)
}</code></pre>

                <p><strong>3. ä½¿ç”¨ WaitGroup ç­‰å¾… Goroutineï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
)

<span class="function">func</span> <span class="function">worker</span>(id <span class="keyword">int</span>, wg *sync.WaitGroup) {
    <span class="keyword">defer</span> wg.<span class="function">Done</span>()
    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å®Œæˆ\n"</span>, id)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> wg sync.WaitGroup
    
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="function">worker</span>(i, &amp;wg)
    }
    
    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ worker å®Œæˆ"</span>)
}</code></pre>

                <p><strong>4. ä½¿ç”¨ ErrGroup å¤„ç†é”™è¯¯ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"errors"</span>
    <span class="string">"fmt"</span>
    <span class="string">"golang.org/x/sync/errgroup"</span>
)

<span class="function">func</span> <span class="function">task</span>(name <span class="keyword">string</span>, shouldFail <span class="keyword">bool</span>) <span class="keyword">error</span> {
    fmt.<span class="function">Printf</span>(<span class="string">"Task %s å¼€å§‹\n"</span>, name)
    <span class="keyword">if</span> shouldFail {
        <span class="keyword">return</span> errors.<span class="function">New</span>(<span class="string">"task failed"</span>)
    }
    fmt.<span class="function">Printf</span>(<span class="string">"Task %s å®Œæˆ\n"</span>, name)
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> g errgroup.Group
    
    g.<span class="function">Go</span>(<span class="keyword">func</span>() <span class="keyword">error</span> {
        <span class="keyword">return</span> <span class="function">task</span>(<span class="string">"A"</span>, <span class="keyword">false</span>)
    })
    
    g.<span class="function">Go</span>(<span class="keyword">func</span>() <span class="keyword">error</span> {
        <span class="keyword">return</span> <span class="function">task</span>(<span class="string">"B"</span>, <span class="keyword">true</span>) <span class="comment">// è¿™ä¸ªä¼šå¤±è´¥</span>
    })
    
    g.<span class="function">Go</span>(<span class="keyword">func</span>() <span class="keyword">error</span> {
        <span class="keyword">return</span> <span class="function">task</span>(<span class="string">"C"</span>, <span class="keyword">false</span>)
    })
    
    <span class="keyword">if</span> err := g.<span class="function">Wait</span>(); err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"é”™è¯¯:"</span>, err)
    }
}</code></pre>

                <p><strong>5. ä½¿ç”¨ Channel è¿›è¡Œé€šä¿¡ï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">producer</span>(ch <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>) {
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {
        ch &lt;- i
        fmt.<span class="function">Printf</span>(<span class="string">"ç”Ÿäº§: %d\n"</span>, i)
        time.<span class="function">Sleep</span>(<span class="number">100</span> * time.Millisecond)
    }
    <span class="keyword">close</span>(ch)
}

<span class="function">func</span> <span class="function">consumer</span>(ch &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>) {
    <span class="keyword">for</span> val := <span class="keyword">range</span> ch {
        fmt.<span class="function">Printf</span>(<span class="string">"æ¶ˆè´¹: %d\n"</span>, val)
        time.<span class="function">Sleep</span>(<span class="number">150</span> * time.Millisecond)
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    ch := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)
    
    <span class="keyword">go</span> <span class="function">producer</span>(ch)
    <span class="keyword">go</span> <span class="function">consumer</span>(ch)
    
    time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
}</code></pre>

                <p><strong>6. ä½¿ç”¨ Context å–æ¶ˆ Goroutineï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">worker</span>(ctx context.Context, id <span class="keyword">int</span>) {
    <span class="keyword">for</span> {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
            fmt.<span class="function">Printf</span>(<span class="string">"Worker %d è¢«å–æ¶ˆ\n"</span>, id)
            <span class="keyword">return</span>
        <span class="keyword">default</span>:
            fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å·¥ä½œä¸­...\n"</span>, id)
            time.<span class="function">Sleep</span>(<span class="number">500</span> * time.Millisecond)
        }
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    ctx, cancel := context.<span class="function">WithCancel</span>(context.<span class="function">Background</span>())
    
    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++ {
        <span class="keyword">go</span> <span class="function">worker</span>(ctx, i)
    }
    
    time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
    cancel() <span class="comment">// å–æ¶ˆæ‰€æœ‰ goroutine</span>
    
    time.<span class="function">Sleep</span>(<span class="number">1</span> * time.Second)
}</code></pre>

                <p><strong>7. ä½¿ç”¨ Mutex ä¿æŠ¤å…±äº«èµ„æºï¼š</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
)

<span class="keyword">type</span> Counter <span class="keyword">struct</span> {
    mu    sync.Mutex
    value <span class="keyword">int</span>
}

<span class="function">func</span> (c *Counter) <span class="function">Increment</span>() {
    c.mu.<span class="function">Lock</span>()
    <span class="keyword">defer</span> c.mu.<span class="function">Unlock</span>()
    c.value++
}

<span class="function">func</span> (c *Counter) <span class="function">Value</span>() <span class="keyword">int</span> {
    c.mu.<span class="function">Lock</span>()
    <span class="keyword">defer</span> c.mu.<span class="function">Unlock</span>()
    <span class="keyword">return</span> c.value
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> counter Counter
    <span class="keyword">var</span> wg sync.WaitGroup
    
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="keyword">func</span>() {
            <span class="keyword">defer</span> wg.<span class="function">Done</span>()
            counter.<span class="function">Increment</span>()
        }()
    }
    
    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Printf</span>(<span class="string">"æœ€ç»ˆå€¼: %d\n"</span>, counter.<span class="function">Value</span>())
}</code></pre>

                <p><strong>8. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼š</strong></p>
                <ul>
                    <li><strong>é¿å…è¿‡åº¦åˆ›å»º goroutine</strong>ï¼šä½¿ç”¨ worker pool æ¨¡å¼</li>
                    <li><strong>åˆç†è®¾ç½® GOMAXPROCS</strong>ï¼šæ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´</li>
                    <li><strong>ä½¿ç”¨ç¼“å†² channel</strong>ï¼šå‡å°‘é˜»å¡</li>
                    <li><strong>é¿å…é”ç«äº‰</strong>ï¼šå°½é‡ä½¿ç”¨ channel é€šä¿¡</li>
                    <li><strong>ä½¿ç”¨ sync.Pool</strong>ï¼šé‡ç”¨å¯¹è±¡ï¼Œå‡å°‘ GC å‹åŠ›</li>
                    <li><strong>ç›‘æ§ goroutine æ•°é‡</strong>ï¼šä½¿ç”¨ runtime.NumGoroutine()</li>
                </ul>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"runtime"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">monitorGoroutines</span>() {
    ticker := time.<span class="function">NewTicker</span>(<span class="number">1</span> * time.Second)
    <span class="keyword">defer</span> ticker.<span class="function">Stop</span>()
    
    <span class="keyword">for</span> <span class="keyword">range</span> ticker.C {
        fmt.<span class="function">Printf</span>(<span class="string">"å½“å‰ goroutine æ•°é‡: %d\n"</span>, runtime.<span class="function">NumGoroutine</span>())
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">go</span> <span class="function">monitorGoroutines</span>()
    
    <span class="keyword">var</span> wg sync.WaitGroup
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="keyword">func</span>() {
            <span class="keyword">defer</span> wg.<span class="function">Done</span>()
            time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
        }()
    }
    
    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ goroutine å®Œæˆ"</span>)
}</code></pre>
            </div>

            <h2 id="channel">Channel</h2>
            <p>Channel æ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„ç®¡é“ã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">sum</span>(s []<span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>) {
    sum := <span class="number">0</span>
    <span class="keyword">for</span> _, v := <span class="keyword">range</span> s {
        sum += v
    }
    c &lt;- sum <span class="comment">// å°†å’Œå‘é€åˆ° channel</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    s := []<span class="keyword">int</span>{<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, -<span class="number">9</span>, <span class="number">4</span>, <span class="number">0</span>}

    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    <span class="keyword">go</span> <span class="function">sum</span>(s[:<span class="function">len</span>(s)/<span class="number">2</span>], c)
    <span class="keyword">go</span> <span class="function">sum</span>(s[<span class="function">len</span>(s)/<span class="number">2</span>:], c)
    x, y := &lt;-c, &lt;-c <span class="comment">// ä» channel æ¥æ”¶</span>

    fmt.<span class="function">Println</span>(x, y, x+y)
}</code></pre>

            <h2 id="buffered">Buffered Channel</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ›å»ºå¸¦ç¼“å†²çš„ channel</span>
    ch := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)

    ch &lt;- <span class="number">1</span>
    ch &lt;- <span class="number">2</span>

    fmt.<span class="function">Println</span>(&lt;-ch)
    fmt.<span class="function">Println</span>(&lt;-ch)
}</code></pre>

            <h2 id="range">Range å’Œ Close</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">fibonacci</span>(n <span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>) {
    x, y := <span class="number">0</span>, <span class="number">1</span>
    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ {
        c &lt;- x
        x, y = y, x+y
    }
    <span class="keyword">close</span>(c) <span class="comment">// å…³é—­ channel</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)
    <span class="keyword">go</span> <span class="function">fibonacci</span>(<span class="number">cap</span>(c), c)

    <span class="comment">// range ä¼šæŒç»­ä» channel æ¥æ”¶ï¼Œç›´åˆ° channel è¢«å…³é—­</span>
    <span class="keyword">for</span> i := <span class="keyword">range</span> c {
        fmt.<span class="function">Println</span>(i)
    }
}</code></pre>

            <h2 id="select">Select</h2>
            <p>Select è¯­å¥è®© goroutine å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚</p>

            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> <span class="string">"fmt"</span>

<span class="function">func</span> <span class="function">fibonacci</span>(c, quit <span class="keyword">chan</span> <span class="keyword">int</span>) {
    x, y := <span class="number">0</span>, <span class="number">1</span>
    <span class="keyword">for</span> {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> c &lt;- x:
            x, y = y, x+y
        <span class="keyword">case</span> &lt;-quit:
            fmt.<span class="function">Println</span>(<span class="string">"quit"</span>)
            <span class="keyword">return</span>
        }
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    c := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)
    quit := <span class="function">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)

    <span class="keyword">go</span> <span class="function">func</span>() {
        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {
            fmt.<span class="function">Println</span>(&lt;-c)
        }
        quit &lt;- <span class="number">0</span>
    }()

    <span class="function">fibonacci</span>(c, quit)
}</code></pre>

            <h2 id="default">é»˜è®¤é€‰æ‹©</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">main</span>() {
    tick := time.<span class="function">Tick</span>(<span class="number">100</span> * time.Millisecond)
    boom := time.<span class="function">After</span>(<span class="number">500</span> * time.Millisecond)

    <span class="keyword">for</span> {
        <span class="keyword">select</span> {
        <span class="keyword">case</span> &lt;-tick:
            fmt.<span class="function">Println</span>(<span class="string">"tick."</span>)
        <span class="keyword">case</span> &lt;-boom:
            fmt.<span class="function">Println</span>(<span class="string">"BOOM!"</span>)
            <span class="keyword">return</span>
        <span class="keyword">default</span>:
            fmt.<span class="function">Println</span>(<span class="string">"    ."</span>)
            time.<span class="function">Sleep</span>(<span class="number">50</span> * time.Millisecond)
        }
    }
}</code></pre>

            <h2 id="mutex">äº’æ–¥é”ï¼ˆMutexï¼‰</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="comment">// SafeCounter æ˜¯å¹¶å‘å®‰å…¨çš„è®¡æ•°å™¨</span>
<span class="keyword">type</span> SafeCounter <span class="keyword">struct</span> {
    mu sync.Mutex
    v  <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>
}

<span class="function">func</span> (c *SafeCounter) <span class="function">Inc</span>(key <span class="keyword">string</span>) {
    c.mu.<span class="function">Lock</span>()
    <span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span>
    c.v[key]++
    c.mu.<span class="function">Unlock</span>()
}

<span class="function">func</span> (c *SafeCounter) <span class="function">Value</span>(key <span class="keyword">string</span>) <span class="keyword">int</span> {
    c.mu.<span class="function">Lock</span>()
    <span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span>
    <span class="keyword">defer</span> c.mu.<span class="function">Unlock</span>()
    <span class="keyword">return</span> c.v[key]
}

<span class="function">func</span> <span class="function">main</span>() {
    c := SafeCounter{v: <span class="function">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)}

    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ {
        <span class="keyword">go</span> c.<span class="function">Inc</span>(<span class="string">"somekey"</span>)
    }

    time.<span class="function">Sleep</span>(time.Second)
    fmt.<span class="function">Println</span>(c.<span class="function">Value</span>(<span class="string">"somekey"</span>))
}</code></pre>

            <h2 id="waitgroup">WaitGroup</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"fmt"</span>
    <span class="string">"sync"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">worker</span>(id <span class="keyword">int</span>, wg *sync.WaitGroup) {
    <span class="keyword">defer</span> wg.<span class="function">Done</span>()

    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å¼€å§‹å·¥ä½œ\n"</span>, id)
    time.<span class="function">Sleep</span>(time.Second)
    fmt.<span class="function">Printf</span>(<span class="string">"Worker %d å®Œæˆå·¥ä½œ\n"</span>, id)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> wg sync.WaitGroup

    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {
        wg.<span class="function">Add</span>(<span class="number">1</span>)
        <span class="keyword">go</span> <span class="function">worker</span>(i, &amp;wg)
    }

    wg.<span class="function">Wait</span>()
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰ worker å®Œæˆ"</span>)
}</code></pre>

            <h2 id="context">Context</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ context</span>
    ctx, cancel := context.<span class="function">WithCancel</span>(context.<span class="function">Background</span>())

    <span class="keyword">go</span> <span class="function">func</span>() {
        <span class="keyword">for</span> {
            <span class="keyword">select</span> {
            <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
                fmt.<span class="function">Println</span>(<span class="string">"goroutine è¢«å–æ¶ˆ"</span>)
                <span class="keyword">return</span>
            <span class="keyword">default</span>:
                fmt.<span class="function">Println</span>(<span class="string">"goroutine è¿è¡Œä¸­"</span>)
                time.<span class="function">Sleep</span>(<span class="number">500</span> * time.Millisecond)
            }
        }
    }()

    time.<span class="function">Sleep</span>(<span class="number">2</span> * time.Second)
    fmt.<span class="function">Println</span>(<span class="string">"å–æ¶ˆ goroutine"</span>)
    <span class="function">cancel</span>()
    time.<span class="function">Sleep</span>(time.Second)
}</code></pre>

            <h2 id="timeout">è¶…æ—¶æ§åˆ¶</h2>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
)

<span class="function">func</span> <span class="function">longRunningTask</span>(ctx context.Context) {
    <span class="keyword">select</span> {
    <span class="keyword">case</span> &lt;-time.<span class="function">After</span>(<span class="number">5</span> * time.Second):
        fmt.<span class="function">Println</span>(<span class="string">"ä»»åŠ¡å®Œæˆ"</span>)
    <span class="keyword">case</span> &lt;-ctx.<span class="function">Done</span>():
        fmt.<span class="function">Println</span>(<span class="string">"ä»»åŠ¡è¶…æ—¶:"</span>, ctx.<span class="function">Err</span>())
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è®¾ç½® 2 ç§’è¶…æ—¶</span>
    ctx, cancel := context.<span class="function">WithTimeout</span>(context.<span class="function">Background</span>(), <span class="number">2</span>*time.Second)
    <span class="keyword">defer</span> <span class="function">cancel</span>()

    <span class="function">longRunningTask</span>(ctx)
}</code></pre>
        </div>
    </div>
</body>
</html>