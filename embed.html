<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embed æ ‡å‡†åº“ - Go å­¦ä¹ æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css?v=1.4">
    <script src="scroll.js"></script>
    </head>
<body>
    <div class="container">
        <aside class="sidebar">
        <!-- å¯¼èˆªæ å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </aside>
        <div class="content">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            <h1>Embed æ ‡å‡†åº“</h1>
            <p class="intro">embed åŒ…å…è®¸å°†æ–‡ä»¶ç›´æ¥ç¼–è¯‘è¿›äºŒè¿›åˆ¶ç¨‹åºã€‚</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸ“</div>
                    <h4>æ–‡ä»¶åµŒå…¥</h4>
                    <p>å°†æ–‡ä»¶æ‰“åŒ…è¿›äºŒè¿›åˆ¶</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“„</div>
                    <h4>å­—ç¬¦ä¸²</h4>
                    <p>embed string</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“‚</div>
                    <h4>å­—èŠ‚åˆ‡ç‰‡</h4>
                    <p>embed []byte</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“¦</div>
                    <h4>FS æ¥å£</h4>
                    <p>embed fs.FS</p>
                </div>
            </div>

            <h2 id="introduction">Embed ç®€ä»‹</h2>
            <p><code>embed</code> æ˜¯ Go 1.16 å¼•å…¥çš„æ ‡å‡†åº“ï¼Œç”¨äºåœ¨ç¼–è¯‘æ—¶å°†æ–‡ä»¶åµŒå…¥åˆ° Go ç¨‹åºä¸­ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•ã€ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®åµŒå…¥çš„æ–‡ä»¶ï¼Œæ— éœ€åœ¨è¿è¡Œæ—¶è¯»å–æ–‡ä»¶ç³»ç»Ÿã€‚</p>

            <div class="example-box">
                <h3>Embed çš„æ ¸å¿ƒç‰¹æ€§</h3>
                <ul>
                    <li><strong>ç¼–è¯‘æ—¶åµŒå…¥</strong>ï¼šæ–‡ä»¶åœ¨ç¼–è¯‘æ—¶è¢«åµŒå…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</li>
                    <li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæä¾› stringã€[]byte å’Œ fs.FS ç±»å‹</li>
                    <li><strong>è·¨å¹³å°</strong>ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦</li>
                    <li><strong>é›¶ä¾èµ–</strong>ï¼šä¸éœ€è¦é¢å¤–çš„ä¾èµ–ç®¡ç†</li>
                    <li><strong>ç®€å•æ˜“ç”¨</strong>ï¼šé€šè¿‡ //go:embed æŒ‡ä»¤å£°æ˜</li>
                </ul>
            </div>

            <h2 id="basics">åŸºç¡€ç”¨æ³•</h2>

            <h3>åµŒå…¥å•ä¸ªæ–‡ä»¶ä¸ºå­—ç¬¦ä¸²</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed hello.txt</span>
<span class="keyword">var</span> content <span class="keyword">string</span>

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(content)
}</code></pre>

            <p><code>hello.txt</code> æ–‡ä»¶å†…å®¹ï¼š</p>
            <pre><code>Hello, World!</code></pre>

            <h3>åµŒå…¥å•ä¸ªæ–‡ä»¶ä¸ºå­—èŠ‚æ•°ç»„</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed image.png</span>
<span class="keyword">var</span> imageData []<span class="keyword">byte</span>

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Printf</span>(<span class="string">"Image size: %d bytes\n"</span>, <span class="function">len</span>(imageData))
}</code></pre>

            <h3>åµŒå…¥æ•´ä¸ªç›®å½•</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">//go:embed static/*</span>
<span class="keyword">var</span> staticFiles <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è¯»å–ç›®å½•ä¸­çš„æ–‡ä»¶</span>
    entries, _ := fs.<span class="function">ReadDir</span>(staticFiles, <span class="string">"static"</span>)
    <span class="keyword">for</span> _, entry := <span class="keyword">range</span> entries {
        fmt.<span class="function">Println</span>(entry.<span class="function">Name</span>())
    }
}</code></pre>

            <h3>åµŒå…¥å¤šä¸ªæ–‡ä»¶</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed file1.txt file2.txt file3.txt</span>
<span class="keyword">var</span> files []<span class="keyword">string</span>

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">for</span> i, content := <span class="keyword">range</span> files {
        fmt.<span class="function">Printf</span>(<span class="string">"File %d: %s\n"</span>, i+<span class="number">1</span>, content)
    }
}</code></pre>

            <h2 id="filesystem">æ–‡ä»¶ç³»ç»Ÿ</h2>

            <h3>ä½¿ç”¨ fs.FS æ¥å£</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">//go:embed templates</span>
<span class="keyword">var</span> templatesFS <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">readTemplate</span>(name <span class="keyword">string</span>) (<span class="keyword">string</span>, <span class="keyword">error</span>) {
    content, err := fs.<span class="function">ReadFile</span>(templatesFS, <span class="string">"templates/"</span>+name)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> <span class="string">""</span>, err
    }
    <span class="keyword">return</span> <span class="keyword">string</span>(content), <span class="keyword">nil</span>
}

<span class="function">func</span> <span class="function">listTemplates</span>() {
    fs.<span class="function">WalkDir</span>(templatesFS, <span class="string">"templates"</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        fmt.<span class="function">Println</span>(path)
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
}

<span class="function">func</span> <span class="function">openTemplate</span>(name <span class="keyword">string</span>) (fs.File, <span class="keyword">error</span>) {
    <span class="keyword">return</span> templatesFS.<span class="function">Open</span>(<span class="string">"templates/"</span> + name)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ—å‡ºæ‰€æœ‰æ¨¡æ¿</span>
    <span class="function">listTemplates</span>()
    
    <span class="comment">// è¯»å–æ¨¡æ¿å†…å®¹</span>
    content, err := <span class="function">readTemplate</span>(<span class="string">"index.html"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Error:"</span>, err)
    } <span class="keyword">else</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Template:"</span>, content)
    }
    
    <span class="comment">// æ‰“å¼€æ–‡ä»¶æµ</span>
    file, err := <span class="function">openTemplate</span>(<span class="string">"index.html"</span>)
    <span class="keyword">if</span> err == <span class="keyword">nil</span> {
        <span class="keyword">defer</span> file.<span class="function">Close</span>()
        data, _ := io.<span class="function">ReadAll</span>(file)
        fmt.<span class="function">Println</span>(<span class="string">"File size:"</span>, <span class="function">len</span>(data))
    }
}</code></pre>

            <h3>HTTP æœåŠ¡å™¨ä¸­ä½¿ç”¨ Embed</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"net/http"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFiles <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ›å»ºæ–‡ä»¶æœåŠ¡å™¨</span>
    http.<span class="function">Handle</span>(<span class="string">"/static/"</span>, http.<span class="function">FileServer</span>(http.<span class="function">FS</span>(staticFiles)))
    
    <span class="comment">// æœåŠ¡å•ä¸ªæ–‡ä»¶</span>
    http.<span class="function">HandleFunc</span>(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        content, _ := staticFiles.<span class="function">ReadFile</span>(<span class="string">"static/index.html"</span>)
        w.<span class="function">Write</span>(content)
    })
    
    http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>)
}</code></pre>

            <h2 id="advanced">é«˜çº§ç”¨æ³•</h2>

            <h3>åµŒå¥—ç›®å½•ç»“æ„</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">//go:embed assets</span>
<span class="keyword">var</span> assetsFS <span class="keyword">embed</span>.FS

<span class="comment">// ç›®å½•ç»“æ„ï¼š</span>
<span class="comment">// assets/</span>
<span class="comment">//   â”œâ”€â”€ images/</span>
<span class="comment">//   â”‚   â”œâ”€â”€ logo.png</span>
<span class="comment">//   â”‚   â””â”€â”€ banner.jpg</span>
<span class="comment">//   â”œâ”€â”€ css/</span>
<span class="comment">//   â”‚   â””â”€â”€ style.css</span>
<span class="comment">//   â””â”€â”€ js/</span>
<span class="comment">//       â””â”€â”€ app.js</span>

<span class="function">func</span> <span class="function">walkAssets</span>() {
    fs.<span class="function">WalkDir</span>(assetsFS, <span class="string">"assets"</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        <span class="keyword">if</span> !d.<span class="function">IsDir</span>() {
            fmt.<span class="function">Printf</span>(<span class="string">"File: %s\n"</span>, path)
        }
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
}

<span class="function">func</span> <span class="function">readSubdirectory</span>(subdir <span class="keyword">string</span>) {
    entries, err := fs.<span class="function">ReadDir</span>(assetsFS, <span class="string">"assets/"</span>+subdir)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"Error:"</span>, err)
        <span class="keyword">return</span>
    }
    
    <span class="keyword">for</span> _, entry := <span class="keyword">range</span> entries {
        fmt.<span class="function">Printf</span>(<span class="string">"%s/%s\n"</span>, subdir, entry.<span class="function">Name</span>())
    }
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="function">walkAssets</span>()
    <span class="function">readSubdirectory</span>(<span class="string">"images"</span>)
    <span class="function">readSubdirectory</span>(<span class="string">"css"</span>)
}</code></pre>

            <h3>æ¡ä»¶åµŒå…¥</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"os"</span>
)

<span class="comment">//go:embed config.yaml</span>
<span class="keyword">var</span> config <span class="keyword">string</span>

<span class="function">func</span> <span class="function">loadConfig</span>() {
    <span class="comment">// å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶</span>
    <span class="keyword">if</span> os.<span class="function">Getenv</span>(<span class="string">"ENV"</span>) == <span class="string">"dev"</span> {
        data, err := os.<span class="function">ReadFile</span>(<span class="string">"config.yaml"</span>)
        <span class="keyword">if</span> err == <span class="keyword">nil</span> {
            fmt.<span class="function">Println</span>(<span class="string">"Using external config:"</span>, <span class="keyword">string</span>(data))
            <span class="keyword">return</span>
        }
    }
    
    <span class="comment">// ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨åµŒå…¥çš„é…ç½®</span>
    fmt.<span class="function">Println</span>(<span class="string">"Using embedded config:"</span>, config)
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="function">loadConfig</span>()
}</code></pre>

            <h3>åµŒå…¥ Go æ¨¡æ¿</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"html/template"</span>
    <span class="string">"net/http"</span>
)

<span class="comment">//go:embed templates/*.html</span>
<span class="keyword">var</span> templatesFS <span class="keyword">embed</span>.FS

<span class="keyword">type</span> PageData <span class="keyword">struct</span> {
    Title   <span class="keyword">string</span>
    Content <span class="keyword">string</span>
}

<span class="function">func</span> <span class="function">renderTemplate</span>(w http.ResponseWriter, name <span class="keyword">string</span>, data <span class="keyword">interface</span>{}) <span class="keyword">error</span> {
    tmpl, err := template.<span class="function">ParseFS</span>(templatesFS, <span class="string">"templates/"</span>+name)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    <span class="keyword">return</span> tmpl.<span class="function">Execute</span>(w, data)
}

<span class="function">func</span> <span class="function">main</span>() {
    http.<span class="function">HandleFunc</span>(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        data := PageData{
            Title:   <span class="string">"Hello"</span>,
            Content: <span class="string">"Welcome to my website!"</span>,
        }
        <span class="function">renderTemplate</span>(w, <span class="string">"index.html"</span>, data)
    })
    
    http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>)
}</code></pre>

            <h3>åµŒå…¥ SQL æ–‡ä»¶</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"database/sql"</span>
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">_ "github.com/mattn/go-sqlite3"</span>
)

<span class="comment">//go:embed migrations/*.sql</span>
<span class="keyword">var</span> migrationsFS <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">runMigrations</span>(db *sql.DB) <span class="keyword">error</span> {
    files, err := migrationsFS.<span class="function">ReadDir</span>(<span class="string">"migrations"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    
    <span class="keyword">for</span> _, file := <span class="keyword">range</span> files {
        <span class="keyword">if</span> file.<span class="function">IsDir</span>() {
            <span class="keyword">continue</span>
        }
        
        content, err := migrationsFS.<span class="function">ReadFile</span>(<span class="string">"migrations/"</span> + file.<span class="function">Name</span>())
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        
        _, err = db.<span class="function">Exec</span>(<span class="keyword">string</span>(content))
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        
        fmt.<span class="function">Printf</span>(<span class="string">"Executed migration: %s\n"</span>, file.<span class="function">Name</span>())
    }
    
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    db, _ := sql.<span class="function">Open</span>(<span class="string">"sqlite3"</span>, <span class="string">":memory:"</span>)
    <span class="keyword">defer</span> db.<span class="function">Close</span>()
    
    <span class="function">runMigrations</span>(db)
}</code></pre>

            <h2 id="bestpractices">æœ€ä½³å®è·µ</h2>

            <div class="example-box">
                <h3>1. æ–‡ä»¶ç»„ç»‡</h3>
                <pre><code><span class="comment">// æ¨èçš„é¡¹ç›®ç»“æ„</span>
myapp/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ handlers/
â”œâ”€â”€ embed/
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ *.html
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ config.yaml
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum</code></pre>

                <h3>2. ç‰ˆæœ¬æ§åˆ¶</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed version.txt</span>
<span class="keyword">var</span> version <span class="keyword">string</span>

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Printf</span>(<span class="string">"Version: %s\n"</span>, version)
}

<span class="comment">// version.txt å†…å®¹ï¼š</span>
<span class="comment">// 1.0.0</span></code></pre>

                <h3>3. é…ç½®ç®¡ç†</h3>
                <pre><code><span class="keyword">package</span> config

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"gopkg.in/yaml.v3"</span>
)

<span class="comment">//go:embed config.yaml</span>
<span class="keyword">var</span> configBytes []<span class="keyword">byte</span>

<span class="keyword">type</span> Config <span class="keyword">struct</span> {
    Server ServerConfig <span class="string">`yaml:"server"`</span>
    DB     DBConfig     <span class="string">`yaml:"database"`</span>
}

<span class="keyword">type</span> ServerConfig <span class="keyword">struct</span> {
    Port <span class="keyword">int</span> <span class="string">`yaml:"port"`</span>
}

<span class="keyword">type</span> DBConfig <span class="keyword">struct</span> {
    Host     <span class="keyword">string</span> <span class="string">`yaml:"host"`</span>
    Port     <span class="keyword">int</span>    <span class="string">`yaml:"port"`</span>
    Database <span class="keyword">string</span> <span class="string">`yaml:"database"`</span>
}

<span class="function">func</span> <span class="function">Load</span>() (*Config, <span class="keyword">error</span>) {
    <span class="keyword">var</span> cfg Config
    err := yaml.<span class="function">Unmarshal</span>(configBytes, &cfg)
    <span class="keyword">return</span> &cfg, err
}</code></pre>

                <h3>4. HTTP é™æ€æ–‡ä»¶æœåŠ¡</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"io/fs"</span>
    <span class="string">"net/http"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// å»æ‰ static å‰ç¼€</span>
    strippedFS, err := fs.<span class="function">Sub</span>(staticFS, <span class="string">"static"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">panic</span>(err)
    }
    
    <span class="comment">// åˆ›å»ºæ–‡ä»¶æœåŠ¡å™¨</span>
    fileServer := http.<span class="function">FileServer</span>(http.<span class="function">FS</span>(strippedFS))
    
    <span class="comment">// å¤„ç† SPA è·¯ç”±</span>
    http.<span class="function">Handle</span>(<span class="string">"/"</span>, http.<span class="function">FileServer</span>(http.<span class="function">FS</span>(strippedFS)))
    
    http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>)
}</code></pre>

                <h3>5. æµ‹è¯•</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"testing"</span>
)

<span class="comment">//go:embed testdata/*.txt</span>
<span class="keyword">var</span> testFiles <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">TestEmbed</span>(t *testing.T) {
    content, err := testFiles.<span class="function">ReadFile</span>(<span class="string">"testdata/test.txt"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        t.<span class="function">Fatal</span>(err)
    }
    
    expected := <span class="string">"test content"</span>
    <span class="keyword">if</span> <span class="keyword">string</span>(content) != expected {
        t.<span class="function">Errorf</span>(<span class="string">"expected %s, got %s"</span>, expected, <span class="keyword">string</span>(content))
    }
}</code></pre>

                <h3>6. æ€§èƒ½ä¼˜åŒ–</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"sync"</span>
)

<span class="comment">//go:embed data.json</span>
<span class="keyword">var</span> jsonData []<span class="keyword">byte</span>

<span class="keyword">var</span> (
    parsedData <span class="keyword">interface</span>{},
    once       sync.Once
)

<span class="function">func</span> <span class="function">GetData</span>() <span class="keyword">interface</span>{} {
    once.<span class="function">Do</span>(<span class="keyword">func</span>() {
        <span class="comment">// åªè§£æä¸€æ¬¡</span>
        parsedData = <span class="function">parseJSON</span>(jsonData)
    })
    <span class="keyword">return</span> parsedData
}

<span class="function">func</span> <span class="function">parseJSON</span>(data []<span class="keyword">byte</span>) <span class="keyword">interface</span>{} {
    <span class="comment">// è§£æé€»è¾‘</span>
    <span class="keyword">return</span> <span class="keyword">nil</span>
}</code></pre>

                <h3>7. é”™è¯¯å¤„ç†</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"log"</span>
)

<span class="comment">//go:embed config.yaml</span>
<span class="keyword">var</span> config <span class="keyword">string</span>

<span class="function">func</span> <span class="function">loadConfig</span>() <span class="keyword">error</span> {
    <span class="keyword">if</span> config == <span class="string">""</span> {
        <span class="keyword">return</span> fmt.<span class="function">Errorf</span>(<span class="string">"config is empty"</span>)
    }
    
    <span class="comment">// è§£æé…ç½®</span>
    <span class="keyword">return</span> <span class="keyword">nil</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">if</span> err := <span class="function">loadConfig</span>(); err != <span class="keyword">nil</span> {
        log.<span class="function">Fatal</span>(<span class="string">"Failed to load config:"</span>, err)
    }
}</code></pre>

                <h3>8. å®‰å…¨è€ƒè™‘</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"net/http"</span>
    <span class="string">"path"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">safeFileHandler</span>(w http.ResponseWriter, r *http.Request) {
    <span class="comment">// æ¸…ç†è·¯å¾„ï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»</span>
    filename := path.<span class="function">Clean</span>(r.URL.Path)
    
    <span class="comment">// éªŒè¯æ–‡ä»¶è·¯å¾„</span>
    <span class="keyword">if</span> path.<span class="function">IsAbs</span>(filename) || path.<span class="function">Contains</span>(filename, <span class="string">".."</span>) {
        http.<span class="function">Error</span>(w, <span class="string">"Invalid path"</span>, http.StatusBadRequest)
        <span class="keyword">return</span>
    }
    
    <span class="comment">// è¯»å–æ–‡ä»¶</span>
    content, err := staticFS.<span class="function">ReadFile</span>(<span class="string">"static/"</span> + filename)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        http.<span class="function">NotFound</span>(w, r)
        <span class="keyword">return</span>
    }
    
    w.<span class="function">Write</span>(content)
}</code></pre>

                <h3>9. å¸¸è§é™·é˜±</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">// âŒ é”™è¯¯ï¼šembed æŒ‡ä»¤å¿…é¡»ç´§è·Ÿåœ¨å˜é‡å£°æ˜ä¹‹å</span>
<span class="comment">// var content string</span>
<span class="comment">// //go:embed file.txt</span>

<span class="comment">// âœ… æ­£ç¡®</span>
<span class="comment">//go:embed file.txt</span>
<span class="keyword">var</span> content <span class="keyword">string</span>

<span class="comment">// âŒ é”™è¯¯ï¼šä¸èƒ½åœ¨å‡½æ•°ä¸­ä½¿ç”¨ embed</span>
<span class="comment">// func load() {</span>
<span class="comment">//     //go:embed file.txt</span>
<span class="comment">//     var content string</span>
<span class="comment">// }</span>

<span class="comment">// âŒ é”™è¯¯ï¼šä¸èƒ½åµŒå…¥ç¬¦å·é“¾æ¥</span>
<span class="comment">// //go:embed symlink</span>

<span class="comment">// âœ… æ­£ç¡®ï¼šåªèƒ½åµŒå…¥æ–‡ä»¶å’Œç›®å½•</span>
<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS <span class="keyword">embed</span>.FS

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(content)
}</code></pre>

                <h3>10. å®é™…åº”ç”¨ç¤ºä¾‹</h3>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"io/fs"</span>
    <span class="string">"net/http"</span>
    <span class="string">"time"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS <span class="keyword">embed</span>.FS

<span class="comment">//go:embed templates/*.html</span>
<span class="keyword">var</span> templatesFS <span class="keyword">embed</span>.FS

<span class="comment">//go:embed config.yaml</span>
<span class="keyword">var</span> config <span class="keyword">string</span>

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡</span>
    strippedFS, _ := fs.<span class="function">Sub</span>(staticFS, <span class="string">"static"</span>)
    http.<span class="function">Handle</span>(<span class="string">"/static/"</span>, http.<span class="function">FileServer</span>(http.<span class="function">FS</span>(strippedFS)))
    
    <span class="comment">// è®¾ç½® API è·¯ç”±</span>
    http.<span class="function">HandleFunc</span>(<span class="string">"/api/config"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        w.<span class="function">Write</span>([]<span class="keyword">byte</span>(config))
    })
    
    <span class="comment">// è®¾ç½®ä¸»é¡µ</span>
    http.<span class="function">HandleFunc</span>(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        content, _ := staticFS.<span class="function">ReadFile</span>(<span class="string">"static/index.html"</span>)
        w.<span class="function">Write</span>(content)
    })
    
    <span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span>
    server := &http.Server{
        Addr:         <span class="string">":8080"</span>,
        ReadTimeout:  <span class="number">10</span> * time.Second,
        WriteTimeout: <span class="number">10</span> * time.Second,
    }
    
    fmt.<span class="function">Println</span>(<span class="string">"Server starting on :8080"</span>)
    server.<span class="function">ListenAndServe</span>()
}</code></pre>
            </div>

            <div class="note-box">
                <h3>Embed å†…éƒ¨å®ç°åŸç†</h3>
                
                <p><strong>1. ç¼–è¯‘æ—¶å¤„ç†</strong></p>
                <pre><code><span class="comment">// Go ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶çš„å¤„ç†æµç¨‹ï¼š</span>
<span class="comment">// 1. æ‰«æ //go:embed æŒ‡ä»¤</span>
<span class="comment">// 2. è¯»å–æŒ‡å®šçš„æ–‡ä»¶å’Œç›®å½•</span>
<span class="comment">// 3. å°†æ–‡ä»¶å†…å®¹è½¬æ¢ä¸º Go ä»£ç </span>
<span class="comment">// 4. ç”Ÿæˆä¸€ä¸ªåŒ…å«æ–‡ä»¶æ•°æ®çš„å˜é‡</span>
<span class="comment">// 5. å°†æ•°æ®åµŒå…¥åˆ°æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</span></code></pre>

                <p><strong>2. æ•°æ®å­˜å‚¨æ ¼å¼</strong></p>
                <pre><code><span class="comment">// embed.FS çš„å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="keyword">type</span> FS <span class="keyword">struct</span> {
    files <span class="keyword">map</span>[<span class="keyword">string</span>]*file
}

<span class="keyword">type</span> file <span class="keyword">struct</span> {
    name    <span class="keyword">string</span>
    data    []<span class="keyword">byte</span>
    isDir   <span class="keyword">bool</span>
    entries []<span class="keyword">string</span>
}</code></pre>

                <p><strong>3. æ–‡ä»¶ç³»ç»Ÿæ¥å£</strong></p>
                <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS <span class="keyword">embed</span>.FS

<span class="comment">// embed.FS å®ç°äº† fs.FS æ¥å£ï¼š</span>
<span class="comment">// - Open(name string) (fs.File, error)</span>
<span class="comment">// - ReadFile(name string) ([]byte, error)</span>
<span class="comment">// - ReadDir(name string) ([]fs.DirEntry, error)</span>
<span class="comment">// - Glob(pattern string) ([]string, error)</span>

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// embed.FS æ˜¯åªè¯»çš„</span>
    <span class="comment">// ä¸èƒ½ä¿®æ”¹åµŒå…¥çš„æ–‡ä»¶</span>
    <span class="comment">// ä¸èƒ½åˆ›å»ºæ–°æ–‡ä»¶</span>
}</code></pre>

                <p><strong>4. æ€§èƒ½è€ƒè™‘</strong></p>
                <pre><code><span class="comment">// æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š</span>
<span class="comment">// 1. å¤§æ–‡ä»¶ä¼šå¢åŠ äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°</span>
<span class="comment">// 2. è€ƒè™‘å‹ç¼©åµŒå…¥çš„æ–‡ä»¶</span>
<span class="comment">// 3. ä½¿ç”¨ sync.Once é¿å…é‡å¤è§£æ</span>
<span class="comment">// 4. è€ƒè™‘æŒ‰éœ€åŠ è½½ï¼ˆå¦‚æœå¯èƒ½ï¼‰</span>

<span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"compress/gzip"</span>
    <span class="string">"embed"</span>
    <span class="string">"io"</span>
)

<span class="comment">//go:embed data.json.gz</span>
<span class="keyword">var</span> compressedData []<span class="keyword">byte</span>

<span class="function">func</span> <span class="function">loadData</span>() ([]<span class="keyword">byte</span>, <span class="keyword">error</span>) {
    reader, err := gzip.<span class="function">NewReader</span>(bytes.<span class="function">NewReader</span>(compressedData))
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> <span class="keyword">nil</span>, err
    }
    <span class="keyword">defer</span> reader.<span class="function">Close</span>()
    
    <span class="keyword">return</span> io.<span class="function">ReadAll</span>(reader)
}</code></pre>
            </div>
        </div>
    </div>
<script src="code-collapse.js"></script>

</body>
    <script src="navigation.js"></script>
</html>