<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embed ç®€ä»‹ - Go å­¦ä¹ æ•™ç¨‹</title>
    <link rel="stylesheet" href="styles.css?v=1.4">
    </head>
<body>
    <div class="container">
        <aside class="sidebar">
        <!-- å¯¼èˆªæ å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
    </aside>
                        <div class="content">
            <a href="stdlib.html" class="back-link">â† è¿”å› å¸¸ç”¨æ ‡å‡†åº“</a>
            <h2 id="introduction">Embed ç®€ä»‹</h2>
            <p><code>embed</code> æ˜¯ Go 1.16 å¼•å…¥çš„æ ‡å‡†åº“ï¼Œç”¨äºåœ¨ç¼–è¯‘æ—¶å°†æ–‡ä»¶åµŒå…¥åˆ° Go ç¨‹åºä¸­ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•ã€ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥è®¿é—®åµŒå…¥çš„æ–‡ä»¶ï¼Œæ— éœ€åœ¨è¿è¡Œæ—¶è¯»å–æ–‡ä»¶ç³»ç»Ÿã€‚</p>

            <div class="example-box">
                <h3>Embed çš„æ ¸å¿ƒç‰¹æ€§</h3>
                <ul>
                    <li><strong>ç¼–è¯‘æ—¶åµŒå…¥</strong>ï¼šæ–‡ä»¶åœ¨ç¼–è¯‘æ—¶è¢«åµŒå…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</li>
                    <li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæä¾› stringã€[]byte å’Œ fs.FS ç±»å‹</li>
                    <li><strong>è·¨å¹³å°</strong>ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦</li>
                    <li><strong>é›¶ä¾èµ–</strong>ï¼šä¸éœ€è¦é¢å¤–çš„ä¾èµ–ç®¡ç†</li>
                    <li><strong>ç®€å•æ˜“ç”¨</strong>ï¼šé€šè¿‡ //go:embed æŒ‡ä»¤å£°æ˜</li>
                </ul>
            </div>

            <h3>åµŒå…¥å•ä¸ªæ–‡ä»¶ä¸ºå­—ç¬¦ä¸²</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">_ "embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed config.txt</span>
<span class="keyword">var</span> configFile <span class="keyword">string</span>

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"é…ç½®æ–‡ä»¶å†…å®¹:"</span>)
    fmt.<span class="function">Println</span>(configFile)
}</code></pre>

            <p><strong>config.txt æ–‡ä»¶å†…å®¹ï¼š</strong></p>
            <pre><code>app.name=MyApp
app.version=1.0.0
debug=true</code></pre>

            <h3>åµŒå…¥å•ä¸ªæ–‡ä»¶ä¸ºå­—èŠ‚åˆ‡ç‰‡</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">_ "embed"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed logo.png</span>
<span class="keyword">var</span> logo []<span class="keyword">byte</span>

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Printf</span>(<span class="string">"Logo å¤§å°: %d å­—èŠ‚\n"</span>, <span class="function">len</span>(logo))
    fmt.<span class="function">Printf</span>(<span class="string">"Logo å‰å‡ ä¸ªå­—èŠ‚: %x\n"</span>, logo[:<span class="function">min</span>(<span class="number">10</span>, <span class="function">len</span>(logo))])
}</code></pre>

            <h3>åµŒå…¥å¤šä¸ªæ–‡ä»¶ä¸ºæ–‡ä»¶ç³»ç»Ÿ</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">//go:embed templates/*.html</span>
<span class="keyword">var</span> templatesFS embed.FS

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"è¯»å–æ¨¡æ¿æ–‡ä»¶:"</span>)
    
    <span class="comment">// éå†æ–‡ä»¶ç³»ç»Ÿ</span>
    err := fs.<span class="function">WalkDir</span>(templatesFS, <span class="string">"."</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        
        <span class="keyword">if</span> !d.<span class="function">IsDir</span>() {
            fmt.<span class="function">Printf</span>(<span class="string">"æ–‡ä»¶: %s\n"</span>, path)
            
            <span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span>
            content, err := fs.<span class="function">ReadFile</span>(templatesFS, path)
            <span class="keyword">if</span> err == <span class="keyword">nil</span> {
                fmt.<span class="function">Printf</span>(<span class="string">"å†…å®¹: %s\n"</span>, <span class="keyword">string</span>(content))
            }
        }
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
    
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"é”™è¯¯:"</span>, err)
    }
}</code></pre>

            <h3>åµŒå…¥æ•´ä¸ªç›®å½•</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
    <span class="string">"log"</span>
    <span class="string">"net/http"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS embed.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// åˆ—å‡ºåµŒå…¥çš„é™æ€æ–‡ä»¶</span>
    err := fs.<span class="function">WalkDir</span>(staticFS, <span class="string">"static"</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            <span class="keyword">return</span> err
        }
        <span class="keyword">if</span> d.<span class="function">IsDir</span>() {
            fmt.<span class="function">Printf</span>(<span class="string">"ç›®å½•: %s\n"</span>, path)
        } <span class="keyword">else</span> {
            fmt.<span class="function">Printf</span>(<span class="string">"æ–‡ä»¶: %s\n"</span>, path)
        }
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
    
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        log.<span class="function">Fatal</span>(err)
    }
    
    <span class="comment">// åˆ›å»º HTTP æœåŠ¡å™¨</span>
    <span class="comment">// æ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ fs.Sub æ¥å»æ‰ "static" å‰ç¼€</span>
    staticFiles, err := fs.<span class="function">Sub</span>(staticFS, <span class="string">"static"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        log.<span class="function">Fatal</span>(err)
    }
    
    http.<span class="function">Handle</span>(<span class="string">"/"</span>, http.<span class="function">FileServer</span>(http.FS(staticFiles)))
    fmt.<span class="function">Println</span>(<span class="string">"æœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8080"</span>)
    log.<span class="function">Fatal</span>(http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>))
}</code></pre>

            <div class="info-box">
                <h3>ğŸ’¡ ç›®å½•ç»“æ„ç¤ºä¾‹</h3>
                <pre><code>project/
â”œâ”€â”€ main.go
â”œâ”€â”€ config.txt
â”œâ”€â”€ logo.png
â””â”€â”€ static/
    â”œâ”€â”€ index.html
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css
    â””â”€â”€ js/
        â””â”€â”€ app.js
</code></pre>
            </div>

            <h3>åµŒå…¥ HTML æ¨¡æ¿</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"html/template"</span>
)

<span class="comment">//go:embed templates/index.html</span>
<span class="keyword">var</span> indexTemplate <span class="keyword">string</span>

<span class="comment">//go:embed templates/*.html</span>
<span class="keyword">var</span> templatesFS embed.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²</span>
    tmpl, err := template.<span class="function">New</span>(<span class="string">"index"</span>).<span class="function">Parse</span>(indexTemplate)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"è§£ææ¨¡æ¿é”™è¯¯:"</span>, err)
        <span class="keyword">return</span>
    }
    
    <span class="comment">// æ–¹æ³•2ï¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ</span>
    tmplFS, err := template.<span class="function">ParseFS</span>(templatesFS, <span class="string">"templates/*.html"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"è§£ææ¨¡æ¿é”™è¯¯:"</span>, err)
        <span class="keyword">return</span>
    }
    
    data := <span class="keyword">struct</span> {
        Title   <span class="keyword">string</span>
        Message <span class="keyword">string</span>
    }{
        Title:   <span class="string">"æ¬¢è¿"</span>,
        Message: <span class="string">"Hello, Go Embed!"</span>,
    }
    
    err = tmpl.<span class="function">Execute</span>(<span class="keyword">nil</span>, data)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"æ‰§è¡Œæ¨¡æ¿é”™è¯¯:"</span>, err)
    }
    
    <span class="comment">// ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¨¡æ¿</span>
    err = tmplFS.<span class="function">ExecuteTemplate</span>(<span class="keyword">nil</span>, <span class="string">"index.html"</span>, data)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"æ‰§è¡Œæ¨¡æ¿é”™è¯¯:"</span>, err)
    }
}</code></pre>

            <h3>åµŒå…¥é…ç½®æ–‡ä»¶ï¼ˆJSON/YAMLï¼‰</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">_ "embed"</span>
    <span class="string">"encoding/json"</span>
    <span class="string">"fmt"</span>
)

<span class="comment">//go:embed config.json</span>
<span class="keyword">var</span> configFile <span class="keyword">string</span>

<span class="keyword">type</span> Config <span class="keyword">struct</span> {
    AppName <span class="keyword">string</span> <span class="string">`json:"app_name"`</span>
    Version <span class="keyword">string</span> <span class="string">`json:"version"`</span>
    Debug   <span class="keyword">bool</span>   <span class="string">`json:"debug"`</span>
    Server  <span class="keyword">struct</span> {
        Host <span class="keyword">string</span> <span class="string">`json:"host"`</span>
        Port <span class="keyword">int</span>    <span class="string">`json:"port"`</span>
    } <span class="string">`json:"server"`</span>
}

<span class="function">func</span> <span class="function">main</span>() {
    <span class="keyword">var</span> config Config
    
    err := json.<span class="function">Unmarshal</span>([]<span class="keyword">byte</span>(configFile), &config)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        fmt.<span class="function">Println</span>(<span class="string">"è§£æé…ç½®é”™è¯¯:"</span>, err)
        <span class="keyword">return</span>
    }
    
    fmt.<span class="function">Printf</span>(<span class="string">"åº”ç”¨åç§°: %s\n"</span>, config.AppName)
    fmt.<span class="function">Printf</span>(<span class="string">"ç‰ˆæœ¬: %s\n"</span>, config.Version)
    fmt.<span class="function">Printf</span>(<span class="string">"è°ƒè¯•æ¨¡å¼: %v\n"</span>, config.Debug)
    fmt.<span class="function">Printf</span>(<span class="string">"æœåŠ¡å™¨: %s:%d\n"</span>, config.Server.Host, config.Server.Port)
}</code></pre>

            <p><strong>config.json æ–‡ä»¶å†…å®¹ï¼š</strong></p>
            <pre><code>{
    "app_name": "MyGoApp",
    "version": "1.0.0",
    "debug": true,
    "server": {
        "host": "localhost",
        "port": 8080
    }
}</code></pre>

            <h3>ä½¿ç”¨é€šé…ç¬¦</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
)

<span class="comment">// åµŒå…¥æ‰€æœ‰ .txt æ–‡ä»¶</span>
<span class="comment">//go:embed *.txt</span>
<span class="keyword">var</span> textFiles embed.FS

<span class="comment">// åµŒå…¥æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰</span>
<span class="comment">//go:embed all:*</span>
<span class="keyword">var</span> allFiles embed.FS

<span class="comment">// åµŒå…¥ç‰¹å®šæ¨¡å¼</span>
<span class="comment">//go:embed data/*.json</span>
<span class="keyword">var</span> jsonFiles embed.FS

<span class="function">func</span> <span class="function">main</span>() {
    fmt.<span class="function">Println</span>(<span class="string">"æ‰€æœ‰æ–‡æœ¬æ–‡ä»¶:"</span>)
    fs.<span class="function">WalkDir</span>(textFiles, <span class="string">"."</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> || d.<span class="function">IsDir</span>() {
            <span class="keyword">return</span> err
        }
        fmt.<span class="function">Printf</span>(<span class="string">"  - %s\n"</span>, path)
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
    
    fmt.<span class="function">Println</span>(<span class="string">"\næ‰€æœ‰ JSON æ–‡ä»¶:"</span>)
    fs.<span class="function">WalkDir</span>(jsonFiles, <span class="string">"."</span>, <span class="keyword">func</span>(path <span class="keyword">string</span>, d fs.DirEntry, err <span class="keyword">error</span>) <span class="keyword">error</span> {
        <span class="keyword">if</span> err != <span class="keyword">nil</span> || d.<span class="function">IsDir</span>() {
            <span class="keyword">return</span> err
        }
        fmt.<span class="function">Printf</span>(<span class="string">"  - %s\n"</span>, path)
        <span class="keyword">return</span> <span class="keyword">nil</span>
    })
}</code></pre>

            <div class="warning-box">
                <h3>âš ï¸ Embed ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3>
                <ul>
                    <li><strong>//go:embed æŒ‡ä»¤ä½ç½®</strong>ï¼šå¿…é¡»åœ¨å˜é‡å£°æ˜ç´§ä¸Šæ–¹ï¼Œä¸­é—´ä¸èƒ½æœ‰ç©ºè¡Œ</li>
                    <li><strong>å˜é‡ç±»å‹é™åˆ¶</strong>ï¼šåªèƒ½æ˜¯ stringã€[]byte æˆ– embed.FS ç±»å‹</li>
                    <li><strong>è·¯å¾„é™åˆ¶</strong>ï¼šè·¯å¾„å¿…é¡»æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¸èƒ½åŒ…å« .. æˆ–ç»å¯¹è·¯å¾„</li>
                    <li><strong>æ–‡ä»¶å¤§å°</strong>ï¼šåµŒå…¥å¤§æ–‡ä»¶ä¼šå¢åŠ äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°</li>
                    <li><strong>è·¨å¹³å°è·¯å¾„</strong>ï¼šä½¿ç”¨ / ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œè‡ªåŠ¨å¤„ç†ä¸åŒç³»ç»Ÿ</li>
                    <li><strong>æ„å»ºé™åˆ¶</strong>ï¼šgo run æ”¯æŒåµŒå…¥ï¼Œä½†æŸäº›æ„å»ºå·¥å…·å¯èƒ½ä¸æ”¯æŒ</li>
                </ul>
            </div>

            <h3>å®Œæ•´çš„ Web æœåŠ¡å™¨ç¤ºä¾‹</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"embed"</span>
    <span class="string">"fmt"</span>
    <span class="string">"io/fs"</span>
    <span class="string">"log"</span>
    <span class="string">"net/http"</span>
)

<span class="comment">//go:embed static</span>
<span class="keyword">var</span> staticFS embed.FS

<span class="comment">//go:embed templates/*.html</span>
<span class="keyword">var</span> templatesFS embed.FS

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡</span>
    staticFiles, err := fs.<span class="function">Sub</span>(staticFS, <span class="string">"static"</span>)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        log.<span class="function">Fatal</span>(err)
    }
    http.<span class="function">Handle</span>(<span class="string">"/static/"</span>, http.<span class="function">FileServer</span>(http.FS(staticFiles)))
    
    <span class="comment">// è®¾ç½®ä¸»é¡µ</span>
    http.<span class="function">HandleFunc</span>(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        content, err := fs.<span class="function">ReadFile</span>(templatesFS, <span class="string">"templates/index.html"</span>)
        <span class="keyword">if</span> err != <span class="keyword">nil</span> {
            http.<span class="function">Error</span>(w, err.<span class="function">Error</span>(), http.StatusInternalServerError)
            <span class="keyword">return</span>
        }
        w.<span class="function">Header</span>().<span class="function">Set</span>(<span class="string">"Content-Type"</span>, <span class="string">"text/html; charset=utf-8"</span>)
        w.<span class="function">Write</span>(content)
    })
    
    <span class="comment">// API ç«¯ç‚¹</span>
    http.<span class="function">HandleFunc</span>(<span class="string">"/api/status"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        w.<span class="function">Header</span>().<span class="function">Set</span>(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>)
        fmt.<span class="function">Fprint</span>(w, <span class="string">`{"status": "ok", "message": "Server is running"}`</span>)
    })
    
    fmt.<span class="function">Println</span>(<span class="string">"æœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8080"</span>)
    log.<span class="function">Fatal</span>(http.<span class="function">ListenAndServe</span>(<span class="string">":8080"</span>, <span class="keyword">nil</span>))
}</code></pre>

            <table>
                <caption>Embed æ”¯æŒçš„ç±»å‹å’Œç”¨æ³•</caption>
                <thead>
                    <tr>
                        <th>ç±»å‹</th>
                        <th>ç”¨é€”</th>
                        <th>ç¤ºä¾‹</th>
                        <th>é€‚ç”¨åœºæ™¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>string</strong></td>
                        <td>åµŒå…¥ä¸ºå­—ç¬¦ä¸²</td>
                        <td><code>var s string</code></td>
                        <td>æ–‡æœ¬æ–‡ä»¶ã€é…ç½®æ–‡ä»¶</td>
                    </tr>
                    <tr>
                        <td><strong>[]byte</strong></td>
                        <td>åµŒå…¥ä¸ºå­—èŠ‚åˆ‡ç‰‡</td>
                        <td><code>var b []byte</code></td>
                        <td>äºŒè¿›åˆ¶æ–‡ä»¶ã€å›¾ç‰‡ã€å‹ç¼©åŒ…</td>
                    </tr>
                    <tr>
                        <td><strong>embed.FS</strong></td>
                        <td>åµŒå…¥ä¸ºæ–‡ä»¶ç³»ç»Ÿ</td>
                        <td><code>var fsys embed.FS</code></td>
                        <td>ç›®å½•ã€å¤šä¸ªæ–‡ä»¶</td>
                    </tr>
                </tbody>
            </table>

            <div class="success-box">
                <h3>âœ… Embed çš„æœ€ä½³å®è·µ</h3>
                <ul>
                    <li><strong>å°æ–‡ä»¶ä¼˜å…ˆ</strong>ï¼šåªåµŒå…¥å¿…è¦çš„å°æ–‡ä»¶ï¼Œé¿å…åµŒå…¥å¤§æ–‡ä»¶</li>
                    <li><strong>é™æ€èµ„æº</strong>ï¼šé€‚åˆåµŒå…¥é™æ€ HTMLã€CSSã€JS ç­‰èµ„æº</li>
                    <li><strong>é…ç½®æ–‡ä»¶</strong>ï¼šé€‚åˆåµŒå…¥é»˜è®¤é…ç½®æˆ–ç¤ºä¾‹é…ç½®</li>
                    <li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šåµŒå…¥çš„æ–‡ä»¶ä¼šè¢«åŒ…å«åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­</li>
                    <li><strong>æ„å»ºä¼˜åŒ–</strong>ï¼šä½¿ç”¨æ„å»ºæ ‡ç­¾æ§åˆ¶ä¸åŒç¯å¢ƒä¸‹çš„åµŒå…¥</li>
                </ul>
            </div>
            


        </div>
    </div>
<script src="code-collapse.js"></script>

</body>
    <script src="navigation.js"></script>
</html>