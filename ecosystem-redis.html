<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis 客户端 - Go 学习教程</title>
    <link rel="stylesheet" href="styles.css?v=1.3">
    </head>
<body>
    <div class="container">
        <aside class="sidebar">
        <!-- 导航栏将通过JavaScript动态加载 -->
    </aside>
                <div class="content">
            <a href="ecosystem.html" class="back-link">← 返回社区库</a>
            <h2 id="redis">Redis 客户端</h2>
            <p>Redis 是一个高性能的键值存储数据库，Go 中常用 go-redis 库进行操作。</p>
            
            <h3>快速开始</h3>
            <pre><code><span class="keyword">go get</span> github.com/redis/go-redis/v9</code></pre>
            
            <h3>基本操作</h3>
            <pre><code><span class="keyword">package</span> main

<span class="keyword">import</span> (
    <span class="string">"context"</span>
    <span class="string">"fmt"</span>
    <span class="string">"time"</span>
    <span class="string">"github.com/redis/go-redis/v9"</span>
)

<span class="function">func</span> <span class="function">main</span>() {
    <span class="comment">// 创建客户端</span>
    rdb := redis.<span class="function">NewClient</span>(&redis.Options{
        Addr:     <span class="string">"localhost:6379"</span>,
        Password: <span class="string">""</span>,
        DB:       0,
    })
    
    ctx := context.<span class="function">Background</span>()
    
    <span class="comment">// 设置键值</span>
    err := rdb.<span class="function">Set</span>(ctx, <span class="string">"key"</span>, <span class="string">"value"</span>, 0).<span class="function">Err</span>()
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">panic</span>(err)
    }
    
    <span class="comment">// 获取键值</span>
    val, err := rdb.<span class="function">Get</span>(ctx, <span class="string">"key"</span>).<span class="function">Result</span>()
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">panic</span>(err)
    }
    fmt.<span class="function">Println</span>(<span class="string">"key:"</span>, val)
    
    <span class="comment">// 设置过期时间</span>
    rdb.<span class="function">Set</span>(ctx, <span class="string">"key"</span>, <span class="string">"value"</span>, 10*time.Minute)
    
    <span class="comment">// 删除键</span>
    rdb.<span class="function">Del</span>(ctx, <span class="string">"key"</span>)
}</code></pre>
            
            <h3>数据结构操作</h3>
            <pre><code><span class="comment">// 1. Hash 操作</span>
rdb.<span class="function">HSet</span>(ctx, <span class="string">"user:1"</span>, <span class="string">"name"</span>, <span class="string">"张三"</span>)
rdb.<span class="function">HSet</span>(ctx, <span class="string">"user:1"</span>, <span class="string">"email"</span>, <span class="string">"zhangsan@example.com"</span>)
name, _ := rdb.<span class="function">HGet</span>(ctx, <span class="string">"user:1"</span>, <span class="string">"name"</span>).<span class="function">Result</span>()

<span class="comment">// 2. List 操作</span>
rdb.<span class="function">LPush</span>(ctx, <span class="string">"list"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>)
val, _ := rdb.<span class="function">RPop</span>(ctx, <span class="string">"list"</span>).<span class="function">Result</span>()

<span class="comment">// 3. Set 操作</span>
rdb.<span class="function">SAdd</span>(ctx, <span class="string">"set"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>)
members, _ := rdb.<span class="function">SMembers</span>(ctx, <span class="string">"set"</span>).<span class="function">Result</span>()

<span class="comment">// 4. Sorted Set 操作</span>
rdb.<span class="function">ZAdd</span>(ctx, <span class="string">"zset"</span>, redis.Z{Score: 1, Member: <span class="string">"a"</span>})
rdb.<span class="function">ZAdd</span>(ctx, <span class="string">"zset"</span>, redis.Z{Score: 2, Member: <span class="string">"b"</span>})
result, _ := rdb.<span class="function">ZRangeWithScores</span>(ctx, <span class="string">"zset"</span>, 0, -1).<span class="function">Result</span>()</code></pre>
            
            <h3>发布订阅</h3>
            <pre><code><span class="comment">// 发布消息</span>
err := rdb.<span class="function">Publish</span>(ctx, <span class="string">"channel"</span>, <span class="string">"message"</span>).<span class="function">Err</span>()

<span class="comment">// 订阅消息</span>
pubsub := rdb.<span class="function">Subscribe</span>(ctx, <span class="string">"channel"</span>)
<span class="keyword">defer</span> pubsub.<span class="function">Close</span>()

<span class="keyword">for</span> {
    msg, err := pubsub.<span class="function">ReceiveMessage</span>(ctx)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">panic</span>(err)
    }
    fmt.<span class="function">Println</span>(<span class="string">"收到消息:"</span>, msg.Payload)
}</code></pre>
            
            <h3>事务</h3>
            <pre><code><span class="comment">// 使用事务</span>
<span class="function">func</span> <span class="function">transfer</span>(from, to <span class="keyword">string</span>, amount <span class="keyword">int64</span>) <span class="keyword">error</span> {
    tx := rdb.<span class="function">TxPipeline</span>()
    
    err := tx.<span class="function">DecrBy</span>(ctx, from, amount).<span class="function">Err</span>()
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> err
    }
    
    tx.<span class="function">IncrBy</span>(ctx, to, amount)
    
    _, err = tx.<span class="function">Exec</span>(ctx)
    <span class="keyword">return</span> err
}</code></pre>
            
            <h3>Redis 最佳实践</h3>
            <div class="note-box">
                <h4>1. 连接池配置</h4>
                <pre><code>rdb := redis.<span class="function">NewClient</span>(&redis.Options{
    Addr:         <span class="string">"localhost:6379"</span>,
    Password:     <span class="string">""</span>,
    DB:           0,
    PoolSize:     10,   <span class="comment">// 连接池大小</span>
    MinIdleConns: 5,    <span class="comment">// 最小空闲连接</span>
    MaxRetries:   3,    <span class="comment">// 最大重试次数</span>
})</code></pre>
                
                <h4>2. 使用 Pipeline</h4>
                <pre><code><span class="comment">// 批量操作使用 Pipeline</span>
pipe := rdb.<span class="function">Pipeline</span>()
pipe.<span class="function">Set</span>(ctx, <span class="string">"key1"</span>, <span class="string">"value1"</span>, 0)
pipe.<span class="function">Set</span>(ctx, <span class="string">"key2"</span>, <span class="string">"value2"</span>, 0)
pipe.<span class="function">Set</span>(ctx, <span class="string">"key3"</span>, <span class="string">"value3"</span>, 0)
cmds, err := pipe.<span class="function">Exec</span>(ctx)</code></pre>
                
                <h4>3. 键命名规范</h4>
                <pre><code><span class="comment">// 使用冒号分隔的层次结构</span>
<span class="string">"user:1:name"</span>
<span class="string">"user:1:email"</span>
<span class="string">"session:abc123"</span>
<span class="string">"cache:product:123"</span></code></pre>
                
                <h4>4. 缓存策略</h4>
                <pre><code><span class="comment">// Cache-Aside 模式</span>
<span class="function">func</span> <span class="function">getUser</span>(id <span class="keyword">int64</span>) (*User, <span class="keyword">error</span>) {
    <span class="comment">// 1. 先查缓存</span>
    key := fmt.<span class="function">Sprintf</span>(<span class="string">"user:%d"</span>, id)
    val, err := rdb.<span class="function">Get</span>(ctx, key).<span class="function">Result</span>()
    <span class="keyword">if</span> err == <span class="keyword">nil</span> {
        <span class="keyword">return</span> <span class="function">unmarshalUser</span>(val)
    }
    
    <span class="comment">// 2. 查数据库</span>
    user, err := db.<span class="function">GetUser</span>(id)
    <span class="keyword">if</span> err != <span class="keyword">nil</span> {
        <span class="keyword">return</span> <span class="keyword">nil</span>, err
    }
    
    <span class="comment">// 3. 写入缓存</span>
    data, _ := json.<span class="function">Marshal</span>(user)
    rdb.<span class="function">Set</span>(ctx, key, data, 10*time.Minute)
    
    <span class="keyword">return</span> user, <span class="keyword">nil</span>
}</code></pre>
            </div>

            
        </div>
    </div>
</body>
    <script src="navigation.js"></script>
</html>